(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[6814],{11952:(e,s,t)=>{Promise.resolve().then(t.bind(t,96277))},95784:(e,s,t)=>{"use strict";t.d(s,{bq:()=>p,eb:()=>u,gC:()=>m,l6:()=>c,yv:()=>o});var a=t(95155);t(12115);var r=t(31992),i=t(66474),n=t(5196),l=t(47863),d=t(53999);function c(e){let{...s}=e;return(0,a.jsx)(r.bL,{"data-slot":"select",...s})}function o(e){let{...s}=e;return(0,a.jsx)(r.WT,{"data-slot":"select-value",...s})}function p(e){let{className:s,size:t="default",children:n,...l}=e;return(0,a.jsxs)(r.l9,{"data-slot":"select-trigger","data-size":t,className:(0,d.cn)("border-input data-[placeholder]:text-muted-foreground [&_svg:not([class*='text-'])]:text-muted-foreground focus-visible:border-ring focus-visible:ring-ring/50 aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive dark:bg-input/30 dark:hover:bg-input/50 flex w-fit items-center justify-between gap-2 rounded-md border bg-transparent px-3 py-2 text-sm whitespace-nowrap shadow-xs transition-[color,box-shadow] outline-none focus-visible:ring-[3px] disabled:cursor-not-allowed disabled:opacity-50 data-[size=default]:h-9 data-[size=sm]:h-8 *:data-[slot=select-value]:line-clamp-1 *:data-[slot=select-value]:flex *:data-[slot=select-value]:items-center *:data-[slot=select-value]:gap-2 [&_svg]:pointer-events-none [&_svg]:shrink-0 [&_svg:not([class*='size-'])]:size-4",s),...l,children:[n,(0,a.jsx)(r.In,{asChild:!0,children:(0,a.jsx)(i.A,{className:"size-4 opacity-50"})})]})}function m(e){let{className:s,children:t,position:i="popper",...n}=e;return(0,a.jsx)(r.ZL,{children:(0,a.jsxs)(r.UC,{"data-slot":"select-content",className:(0,d.cn)("bg-popover text-popover-foreground data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 relative z-50 max-h-(--radix-select-content-available-height) min-w-[8rem] origin-(--radix-select-content-transform-origin) overflow-x-hidden overflow-y-auto rounded-md border shadow-md","popper"===i&&"data-[side=bottom]:translate-y-1 data-[side=left]:-translate-x-1 data-[side=right]:translate-x-1 data-[side=top]:-translate-y-1",s),position:i,...n,children:[(0,a.jsx)(h,{}),(0,a.jsx)(r.LM,{className:(0,d.cn)("p-1","popper"===i&&"h-[var(--radix-select-trigger-height)] w-full min-w-[var(--radix-select-trigger-width)] scroll-my-1"),children:t}),(0,a.jsx)(x,{})]})})}function u(e){let{className:s,children:t,...i}=e;return(0,a.jsxs)(r.q7,{"data-slot":"select-item",className:(0,d.cn)("focus:bg-accent focus:text-accent-foreground [&_svg:not([class*='text-'])]:text-muted-foreground relative flex w-full cursor-default items-center gap-2 rounded-sm py-1.5 pr-8 pl-2 text-sm outline-hidden select-none data-[disabled]:pointer-events-none data-[disabled]:opacity-50 [&_svg]:pointer-events-none [&_svg]:shrink-0 [&_svg:not([class*='size-'])]:size-4 *:[span]:last:flex *:[span]:last:items-center *:[span]:last:gap-2",s),...i,children:[(0,a.jsx)("span",{className:"absolute right-2 flex size-3.5 items-center justify-center",children:(0,a.jsx)(r.VF,{children:(0,a.jsx)(n.A,{className:"size-4"})})}),(0,a.jsx)(r.p4,{children:t})]})}function h(e){let{className:s,...t}=e;return(0,a.jsx)(r.PP,{"data-slot":"select-scroll-up-button",className:(0,d.cn)("flex cursor-default items-center justify-center py-1",s),...t,children:(0,a.jsx)(l.A,{className:"size-4"})})}function x(e){let{className:s,...t}=e;return(0,a.jsx)(r.wn,{"data-slot":"select-scroll-down-button",className:(0,d.cn)("flex cursor-default items-center justify-center py-1",s),...t,children:(0,a.jsx)(i.A,{className:"size-4"})})}},96277:(e,s,t)=>{"use strict";t.d(s,{default:()=>P});var a=t(95155),r=t(12115),i=t(55366),n=t(34964),l=t(88482),d=t(99840),c=t(95784),o=t(97168),p=t(89852),m=t(82714),u=t(99474),h=t(53999);function x(e){let{className:s,...t}=e;return(0,a.jsx)("div",{"data-slot":"table-container",className:"relative w-full overflow-x-auto",children:(0,a.jsx)("table",{"data-slot":"table",className:(0,h.cn)("w-full caption-bottom text-sm",s),...t})})}function j(e){let{className:s,...t}=e;return(0,a.jsx)("thead",{"data-slot":"table-header",className:(0,h.cn)("[&_tr]:border-b",s),...t})}function v(e){let{className:s,...t}=e;return(0,a.jsx)("tbody",{"data-slot":"table-body",className:(0,h.cn)("[&_tr:last-child]:border-0",s),...t})}function y(e){let{className:s,...t}=e;return(0,a.jsx)("tr",{"data-slot":"table-row",className:(0,h.cn)("hover:bg-muted/50 data-[state=selected]:bg-muted border-b transition-colors",s),...t})}function _(e){let{className:s,...t}=e;return(0,a.jsx)("th",{"data-slot":"table-head",className:(0,h.cn)("text-foreground h-10 px-2 text-left align-middle font-medium whitespace-nowrap [&:has([role=checkbox])]:pr-0 [&>[role=checkbox]]:translate-y-[2px]",s),...t})}function g(e){let{className:s,...t}=e;return(0,a.jsx)("td",{"data-slot":"table-cell",className:(0,h.cn)("p-2 align-middle whitespace-nowrap [&:has([role=checkbox])]:pr-0 [&>[role=checkbox]]:translate-y-[2px]",s),...t})}var b=t(88145),f=t(56671),N=t(88893),w=t(13319),k=t(81586),C=t(62525),R=t(33487),S=t(69074),F=t(49103);function P(e){let{sidebarData:s}=e,[t,h]=(0,r.useState)("providers"),[P,T]=(0,r.useState)(null),[E,A]=(0,r.useState)(!1),[J,B]=(0,r.useState)(!1),[U,$]=(0,r.useState)(!1),[z,D]=(0,r.useState)(!1),[I,O]=(0,r.useState)(!1),[q,L]=(0,r.useState)(null),[W,Z]=(0,r.useState)(null),[G,V]=(0,r.useState)(null),[M,X]=(0,r.useState)({name:"",terminal_key:"",secret_key:""}),[K,H]=(0,r.useState)({provider_id:"",customer_key:""}),[Y,Q]=(0,r.useState)({name:"",description:"",price:"",currency:"RUB",interval:"month",interval_count:"1",trial_period_days:"0",features:""}),[ee,es]=(0,r.useState)({plan_id:"",method_id:""}),[et,ea]=(0,r.useState)({amount:"",currency:"RUB",description:""}),[er,ei]=(0,r.useState)(null),en=(0,N.Dh)(),el=(0,N.c3)("payments"),ed=(0,N.c3)("actions"),ec=(0,N.c3)("common"),eo=(0,N.c3)("errors"),{data:ep,loading:em}=(0,N.IT)({table:"payments_providers",returning:["id","name","type","is_test_mode","created_at"],order_by:{created_at:"desc"}});console.log("providers",ep),console.log("providersLoading",em);let{data:eu,loading:eh}=(0,N.IT)({table:"payments_methods",where:{user_id:{_eq:(null==en?void 0:en.userId)||"never-match"}},returning:["id"],order_by:{created_at:"desc"}}),{data:ex,loading:ej}=(0,N.IT)({table:"payments_plans",where:{active:{_eq:!0}},returning:["id","name","description","price","currency","interval","interval_count","trial_period_days","active","features","user_id","created_at"],order_by:{created_at:"desc"}}),{data:ev,loading:ey}=(0,N.IT)({table:"payments_subscriptions",where:{user_id:{_eq:(null==en?void 0:en.userId)||"never-match"}},returning:["id","user_id","method_id","provider_id","plan_id","status","current_period_start","current_period_end","computed_next_billing_date","computed_last_billing_date","computed_missed_cycles","billing_retry_count","created_at",{plan:["name","price","currency","interval","interval_count"]},{method:["type","details"]},{provider:["name","type"]}],order_by:{created_at:"desc"}}),{data:e_,loading:eg}=(0,N.IT)({table:"payments_operations",where:{user_id:{_eq:(null==en?void 0:en.userId)||"never-match"}},returning:["id","user_id","amount","currency","status","description","method_id","provider_id","created_at","subscription_id"],order_by:{created_at:"desc"},limit:50}),{data:eb}=(0,N.IT)({table:"payments_operations",where:er?{id:{_eq:er}}:{id:{_eq:"never-match"}},returning:["id","status","external_operation_id","error_message","provider_response_details","paid_at","updated_at"]});(0,r.useEffect)(()=>{if(eb&&eb.length>0){let e=eb[0];switch(e.status){case"succeeded":f.oR.success(el("toast.paymentCompleted")),ei(null);break;case"failed":f.oR.error(el("toast.paymentFailed",{message:e.error_message||eo("unknown")})),ei(null);break;case"canceled":f.oR.warning(el("toast.paymentCanceled")),ei(null);break;case"pending_user_action":f.oR.info(el("toast.paymentPendingUserAction"));break;case"pending_confirmation":f.oR.info(el("toast.paymentPendingConfirmation"))}}},[eb]);let ef=e=>{L(e),X({name:"tbank_test"===e?"TBank Test":"TBank Production",terminal_key:"",secret_key:""}),A(!0)},eN=async()=>{if(!M.name||!M.terminal_key||!M.secret_key)return void f.oR.error(el("toast.fillAllFields"));try{let e="tbank_test"===q;await en.insert({table:"payments_providers",object:{name:M.name,type:"tbank",is_test_mode:e,config:{terminal_key:M.terminal_key,secret_key:M.secret_key,is_test_mode:e}}}),f.oR.success(el("toast.providerAdded")),A(!1),X({name:"",terminal_key:"",secret_key:""})}catch(e){f.oR.error(el("toast.providerAddFailed",{message:e.message}))}},ew=async()=>{if(!K.provider_id||!K.customer_key)return void f.oR.error(el("toast.fillAllFields"));try{let e=await fetch("/api/payments/tbank/add-card",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({provider_id:K.provider_id,customer_key:K.customer_key})}),s=await e.json();if(s.success&&s.redirect_url)window.open(s.redirect_url,"_blank"),f.oR.info(el("toast.methodAddCompleteVerification"));else throw Error(s.error||el("toast.methodAddFailed"));B(!1),H({provider_id:"",customer_key:""})}catch(e){f.oR.error(el("toast.methodAddFailedWithReason",{message:e.message}))}},ek=async e=>{try{await en.delete({table:"payments_methods",pk_columns:{id:e}}),f.oR.success(el("toast.methodRemoved"))}catch(e){e.message.includes("violates foreign key constraint")?f.oR.error(el("toast.methodRemoveForbidden")):f.oR.error(el("toast.methodRemoveFailed",{message:e.message}))}},eC=async()=>{if(!Y.name||!Y.price||!Y.interval_count)return void f.oR.error(el("toast.fillAllRequired"));try{await en.insert({table:"payments_plans",object:{name:Y.name,description:Y.description,price:parseFloat(Y.price),currency:Y.currency,interval:Y.interval,interval_count:parseInt(Y.interval_count),trial_period_days:parseInt(Y.trial_period_days),features:Y.features?JSON.parse(Y.features):null,user_id:null==en?void 0:en.userId}}),f.oR.success(el("toast.planCreateSuccess")),$(!1),Q({name:"",description:"",price:"",currency:"RUB",interval:"month",interval_count:"1",trial_period_days:"0",features:""})}catch(e){f.oR.error(el("toast.planCreateFailed",{message:e.message}))}},eR=async e=>{try{await en.delete({table:"payments_plans",pk_columns:{id:e}}),f.oR.success("Plan removed successfully!")}catch(e){f.oR.error(el("toast.planRemoveFailed",{message:e.message}))}},eS=async()=>{if(!ee.plan_id||!ee.method_id)return void f.oR.error(el("toast.selectPlanAndMethod"));try{let e=await fetch("/api/payments/tbank/create-subscription",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({plan_id:ee.plan_id,method_id:ee.method_id})}),s=await e.json();if(s.success)s.redirect_url?(window.open(s.redirect_url,"_blank"),f.oR.info(el("toast.subscriptionCreateOpenWindow"))):f.oR.success(el("toast.subscriptionCreateSuccess"));else throw Error(s.error||el("toast.subscriptionCreateFailed"));D(!1),es({plan_id:"",method_id:""})}catch(e){f.oR.error(el("toast.subscriptionCreateFailedWithReason",{message:e.message}))}},eF=async()=>{if(!et.amount||!W)return void f.oR.error(el("toast.fillAllFields"));try{let e=await fetch("/api/payments/tbank/init",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({provider_id:W.id,amount:parseFloat(et.amount),currency:et.currency,description:et.description})}),s=await e.json();if(s.success&&s.redirect_url)ei(s.operation_id),window.open(s.redirect_url,"_blank"),f.oR.info(el("toast.paymentInitOpenWindow"));else throw Error(s.error||el("toast.paymentInitFailed"));O(!1),ea({amount:"",currency:"RUB",description:""})}catch(e){f.oR.error(el("toast.paymentInitFailedWithReason",{message:e.message}))}},eP=(e,s)=>{let t=1===s?e:"".concat(e,"s");return 1===s?t:"".concat(s," ").concat(t)},eT=e=>{switch(e){case"active":case"succeeded":return"default";case"pending_user_action":case"pending_confirmation":return"secondary";case"failed":case"past_due":return"destructive";default:return"outline"}};return(0,a.jsxs)(i.SidebarLayout,{sidebarData:s,children:[(0,a.jsxs)("div",{className:"flex flex-col h-full",children:[(0,a.jsx)("div",{className:"flex items-center justify-between p-4 border-b",children:(0,a.jsx)("h1",{className:"text-2xl font-bold",children:el("title")})}),(0,a.jsxs)(n.tU,{value:t,onValueChange:h,className:"flex-1 flex flex-col",children:[(0,a.jsxs)(n.j7,{className:"w-full justify-start px-4 py-2 border-b",children:[(0,a.jsx)(n.Xi,{value:"providers",children:el("tabs.providers")}),(0,a.jsx)(n.Xi,{value:"methods",children:el("tabs.methods")}),(0,a.jsx)(n.Xi,{value:"plans",children:el("tabs.plans")}),(0,a.jsx)(n.Xi,{value:"subscriptions",children:el("tabs.subscriptions")}),(0,a.jsx)(n.Xi,{value:"operations",children:el("tabs.operations")})]}),(0,a.jsxs)(n.av,{value:"providers",className:"p-4 overflow-auto",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,a.jsx)("h2",{className:"text-lg font-semibold",children:el("providers.title")}),(0,a.jsxs)("div",{className:"space-x-2",children:[(0,a.jsx)(o.$,{variant:"outline",onClick:()=>ef("tbank_test"),children:el("providers.addTest")}),(0,a.jsx)(o.$,{onClick:()=>ef("tbank_prod"),children:el("providers.addProd")})]})]}),em?(0,a.jsx)("div",{children:ec("loading")}):ep&&ep.length>0?(0,a.jsx)("div",{className:"grid gap-4 md:grid-cols-2 lg:grid-cols-3",children:ep.map(e=>(0,a.jsx)(l.Zp,{children:(0,a.jsxs)(l.aR,{children:[(0,a.jsxs)(l.ZB,{className:"flex items-center justify-between",children:[e.name,(0,a.jsx)(b.E,{variant:e.is_test_mode?"secondary":"default",children:e.is_test_mode?el("providers.test"):el("providers.prod")})]}),(0,a.jsxs)(l.BT,{children:[e.type," • ",el("providers.created")," ",(0,w.GP)(new Date(e.created_at),"PPP")]})]})},e.id))}):(0,a.jsx)("div",{className:"text-center py-8",children:(0,a.jsx)("p",{className:"text-muted-foreground",children:el("providers.empty")})})]}),(0,a.jsxs)(n.av,{value:"methods",className:"p-4 overflow-auto",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,a.jsx)("h2",{className:"text-lg font-semibold",children:el("methods.title")}),(0,a.jsxs)(o.$,{onClick:()=>B(!0),children:[(0,a.jsx)(k.A,{className:"h-4 w-4 mr-2"}),el("methods.add")]})]}),eh?(0,a.jsx)("div",{children:ec("loading")}):eu&&eu.length>0?(0,a.jsx)("div",{className:"grid gap-4 md:grid-cols-2 lg:grid-cols-3",children:eu.map(e=>{var s;return(0,a.jsxs)(l.Zp,{children:[(0,a.jsxs)(l.aR,{children:[(0,a.jsxs)(l.ZB,{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{className:"flex items-center",children:[(0,a.jsx)(k.A,{className:"h-4 w-4 mr-2"}),e.type]}),(0,a.jsxs)("div",{className:"flex space-x-1",children:[e.is_default&&(0,a.jsx)(b.E,{variant:"default",children:el("methods.badges.default")}),e.is_recurrent_ready&&(0,a.jsx)(b.E,{variant:"secondary",children:el("methods.badges.recurrent")})]})]}),(0,a.jsxs)(l.BT,{children:[e.provider.name," • ",e.provider.is_test_mode?el("providers.test"):el("providers.prod")]})]}),(0,a.jsx)(l.Wu,{children:(0,a.jsxs)("div",{className:"space-y-2 text-sm",children:[(0,a.jsxs)("div",{children:[el("status"),": ",(0,a.jsx)(b.E,{variant:eT(e.status),children:e.status})]}),(null==(s=e.details)?void 0:s.pan)&&(0,a.jsxs)("div",{children:[el("methods.card"),": **** ",e.details.pan]}),e.expires_at&&(0,a.jsxs)("div",{children:[el("methods.expires"),": ",(0,w.GP)(new Date(e.expires_at),"MM/yy")]})]})}),(0,a.jsx)(l.wL,{children:(0,a.jsxs)(o.$,{variant:"destructive",size:"sm",onClick:()=>ek(e.id),children:[(0,a.jsx)(C.A,{className:"h-4 w-4 mr-2"}),ed("delete")]})})]},e.id)})}):(0,a.jsx)("div",{className:"text-center py-8",children:(0,a.jsx)("p",{className:"text-muted-foreground",children:el("methods.empty")})})]}),(0,a.jsxs)(n.av,{value:"plans",className:"p-4 overflow-auto",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,a.jsx)("h2",{className:"text-lg font-semibold",children:el("plans.title")}),(0,a.jsxs)(o.$,{onClick:()=>$(!0),children:[(0,a.jsx)(R.A,{className:"h-4 w-4 mr-2"}),el("plans.create")]})]}),ej?(0,a.jsx)("div",{children:ec("loading")}):ex&&ex.length>0?(0,a.jsx)("div",{className:"grid gap-4 md:grid-cols-2 lg:grid-cols-3",children:ex.map(e=>(0,a.jsxs)(l.Zp,{children:[(0,a.jsxs)(l.aR,{children:[(0,a.jsxs)(l.ZB,{className:"flex items-center justify-between",children:[e.name,(0,a.jsxs)(b.E,{variant:"default",children:[e.price," ",e.currency]})]}),(0,a.jsxs)(l.BT,{children:[el("plans.every",{interval:eP(e.interval,e.interval_count)}),e.trial_period_days>0&&" • ".concat(el("plans.trial",{days:e.trial_period_days}))]})]}),(0,a.jsxs)(l.Wu,{children:[(0,a.jsx)("p",{className:"text-sm text-muted-foreground",children:e.description}),e.features&&(0,a.jsxs)("div",{className:"mt-2",children:[(0,a.jsx)("p",{className:"text-xs font-medium",children:el("plans.features")}),(0,a.jsx)("pre",{className:"text-xs text-muted-foreground mt-1",children:JSON.stringify(e.features,null,2)})]})]}),(0,a.jsxs)(l.wL,{className:"flex justify-between",children:[(0,a.jsx)(o.$,{variant:"outline",size:"sm",onClick:()=>{V(e),es({...ee,plan_id:e.id}),D(!0)},children:el("plans.subscribe")}),e.user_id===(null==en?void 0:en.userId)&&(0,a.jsx)(o.$,{variant:"destructive",size:"sm",onClick:()=>eR(e.id),children:(0,a.jsx)(C.A,{className:"h-4 w-4"})})]})]},e.id))}):(0,a.jsx)("div",{className:"text-center py-8",children:(0,a.jsx)("p",{className:"text-muted-foreground",children:el("plans.empty")})})]}),(0,a.jsxs)(n.av,{value:"subscriptions",className:"p-4 overflow-auto",children:[(0,a.jsx)("div",{className:"flex items-center justify-between mb-4",children:(0,a.jsx)("h2",{className:"text-lg font-semibold",children:el("subscriptions.title")})}),ey?(0,a.jsx)("div",{children:ec("loading")}):ev&&ev.length>0?(0,a.jsx)("div",{className:"space-y-4",children:ev.map(e=>(0,a.jsxs)(l.Zp,{children:[(0,a.jsxs)(l.aR,{children:[(0,a.jsxs)(l.ZB,{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{className:"flex items-center",children:[(0,a.jsx)(S.A,{className:"h-4 w-4 mr-2"}),e.plan.name]}),(0,a.jsx)(b.E,{variant:eT(e.status),children:e.status})]}),(0,a.jsxs)(l.BT,{children:[e.provider.name," • ",e.method.type]})]}),(0,a.jsx)(l.Wu,{children:(0,a.jsxs)("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"font-medium",children:el("amount")}),(0,a.jsxs)("p",{children:[e.plan.price," ",e.plan.currency]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"font-medium",children:el("billing")}),(0,a.jsx)("p",{children:el("plans.every",{interval:eP(e.plan.interval,e.plan.interval_count)})})]}),e.computed_next_billing_date&&(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"font-medium",children:el("subscriptions.nextBilling")}),(0,a.jsx)("p",{children:(0,w.GP)(new Date(e.computed_next_billing_date),"PPP")})]}),e.computed_last_billing_date&&(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"font-medium",children:el("subscriptions.lastBilling")}),(0,a.jsx)("p",{children:(0,w.GP)(new Date(e.computed_last_billing_date),"PPP")})]}),e.computed_missed_cycles>0&&(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"font-medium",children:el("subscriptions.missed")}),(0,a.jsx)("p",{className:"text-orange-600",children:e.computed_missed_cycles})]}),e.billing_retry_count>0&&(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"font-medium",children:el("subscriptions.retries")}),(0,a.jsx)("p",{className:"text-red-600",children:e.billing_retry_count})]})]})})]},e.id))}):(0,a.jsx)("div",{className:"text-center py-8",children:(0,a.jsx)("p",{className:"text-muted-foreground",children:el("subscriptions.empty")})})]}),(0,a.jsxs)(n.av,{value:"operations",className:"p-4 overflow-auto",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,a.jsx)("h2",{className:"text-lg font-semibold",children:el("operations.title")}),(0,a.jsxs)(o.$,{onClick:()=>O(!0),children:[(0,a.jsx)(F.A,{className:"h-4 w-4 mr-2"}),el("operations.create")]})]}),eg?(0,a.jsx)("div",{children:ec("loading")}):e_&&e_.length>0?(0,a.jsx)("div",{className:"rounded-md border",children:(0,a.jsxs)(x,{children:[(0,a.jsx)(j,{children:(0,a.jsxs)(y,{children:[(0,a.jsx)(_,{children:el("table.id")}),(0,a.jsx)(_,{children:el("table.amount")}),(0,a.jsx)(_,{children:el("table.status")}),(0,a.jsx)(_,{children:el("table.description")}),(0,a.jsx)(_,{children:el("table.type")}),(0,a.jsx)(_,{children:el("table.date")})]})}),(0,a.jsx)(v,{children:e_.map(e=>(0,a.jsxs)(y,{children:[(0,a.jsxs)(g,{className:"font-mono text-xs",children:[e.id.substring(0,8),"..."]}),(0,a.jsxs)(g,{children:[e.amount," ",e.currency]}),(0,a.jsx)(g,{children:(0,a.jsx)(b.E,{variant:eT(e.status),children:e.status})}),(0,a.jsx)(g,{children:e.description||"-"}),(0,a.jsx)(g,{children:e.subscription_id?el("operations.subscription"):el("operations.oneTime")}),(0,a.jsx)(g,{children:(0,w.GP)(new Date(e.created_at),"PPP")})]},e.id))})]})}):(0,a.jsx)("div",{className:"text-center py-8",children:(0,a.jsx)("p",{className:"text-muted-foreground",children:el("operations.empty")})}),er&&eb&&eb.length>0&&(0,a.jsxs)(l.Zp,{className:"mt-4 border-blue-200 bg-blue-50",children:[(0,a.jsxs)(l.aR,{children:[(0,a.jsx)(l.ZB,{className:"text-blue-800",children:el("operations.tracking.title")}),(0,a.jsx)(l.BT,{children:el("operations.tracking.subtitle",{id:er||""})})]}),(0,a.jsx)(l.Wu,{children:(0,a.jsxs)("div",{className:"space-y-2 text-sm",children:[(0,a.jsxs)("div",{children:[(0,a.jsxs)("strong",{children:[el("table.status"),":"]})," ",eb[0].status]}),(0,a.jsxs)("div",{children:[(0,a.jsxs)("strong",{children:[el("operations.externalId"),":"]})," ",eb[0].external_operation_id||el("operations.notAssigned")]}),(0,a.jsxs)("div",{children:[(0,a.jsxs)("strong",{children:[el("operations.lastUpdated"),":"]})," ",new Date(eb[0].updated_at).toLocaleString()]}),eb[0].error_message&&(0,a.jsxs)("div",{children:[(0,a.jsx)("strong",{children:"Error:"})," ",(0,a.jsx)("span",{className:"text-red-600",children:eb[0].error_message})]}),eb[0].paid_at&&(0,a.jsxs)("div",{children:[(0,a.jsxs)("strong",{children:[el("operations.paidAt"),":"]})," ",new Date(eb[0].paid_at).toLocaleString()]})]})})]})]})]}),(0,a.jsx)(d.lG,{open:E,onOpenChange:A,children:(0,a.jsxs)(d.Cf,{children:[(0,a.jsxs)(d.c7,{children:[(0,a.jsx)(d.L3,{children:el("providers.addTitle",{type:"tbank_test"===q?el("providers.test"):el("providers.prod")})}),(0,a.jsx)(d.rr,{children:el("providers.addDescription")})]}),(0,a.jsxs)("div",{className:"space-y-4 py-2",children:[(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(m.J,{htmlFor:"provider-name",children:el("providers.name")}),(0,a.jsx)(p.p,{id:"provider-name",value:M.name,onChange:e=>X({...M,name:e.target.value})})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(m.J,{htmlFor:"terminal-key",children:el("providers.terminal")}),(0,a.jsx)(p.p,{id:"terminal-key",value:M.terminal_key,onChange:e=>X({...M,terminal_key:e.target.value})})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(m.J,{htmlFor:"secret-key",children:el("providers.secret")}),(0,a.jsx)(p.p,{id:"secret-key",type:"password",value:M.secret_key,onChange:e=>X({...M,secret_key:e.target.value})})]})]}),(0,a.jsxs)(d.Es,{children:[(0,a.jsx)(o.$,{variant:"outline",onClick:()=>A(!1),children:ed("cancel")}),(0,a.jsx)(o.$,{onClick:eN,children:el("providers.addSubmit")})]})]})}),(0,a.jsx)(d.lG,{open:J,onOpenChange:B,children:(0,a.jsxs)(d.Cf,{children:[(0,a.jsxs)(d.c7,{children:[(0,a.jsx)(d.L3,{children:el("methods.addTitle")}),(0,a.jsx)(d.rr,{children:el("methods.addDescription")})]}),(0,a.jsxs)("div",{className:"space-y-4 py-2",children:[(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(m.J,{htmlFor:"method-provider",children:el("providers.title")}),(0,a.jsxs)(c.l6,{value:K.provider_id,onValueChange:e=>H({...K,provider_id:e}),children:[(0,a.jsx)(c.bq,{children:(0,a.jsx)(c.yv,{placeholder:"Select provider"})}),(0,a.jsx)(c.gC,{children:null==ep?void 0:ep.map(e=>(0,a.jsxs)(c.eb,{value:e.id,children:[e.name," (",e.is_test_mode?el("providers.test"):el("providers.prod"),")"]},e.id))})]})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(m.J,{htmlFor:"customer-key",children:el("methods.customerKey")}),(0,a.jsx)(p.p,{id:"customer-key",value:K.customer_key,onChange:e=>H({...K,customer_key:e.target.value}),placeholder:el("methods.customerKeyPlaceholder")})]})]}),(0,a.jsxs)(d.Es,{children:[(0,a.jsx)(o.$,{variant:"outline",onClick:()=>B(!1),children:ed("cancel")}),(0,a.jsx)(o.$,{onClick:ew,children:el("methods.add")})]})]})}),(0,a.jsx)(d.lG,{open:U,onOpenChange:$,children:(0,a.jsxs)(d.Cf,{className:"max-w-2xl",children:[(0,a.jsxs)(d.c7,{children:[(0,a.jsx)(d.L3,{children:el("plans.create")}),(0,a.jsx)(d.rr,{children:el("plans.createDescription")})]}),(0,a.jsxs)("div",{className:"space-y-4 py-2",children:[(0,a.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(m.J,{htmlFor:"plan-name",children:el("plans.name")}),(0,a.jsx)(p.p,{id:"plan-name",value:Y.name,onChange:e=>Q({...Y,name:e.target.value})})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(m.J,{htmlFor:"plan-price",children:el("plans.price")}),(0,a.jsx)(p.p,{id:"plan-price",type:"number",step:"0.01",value:Y.price,onChange:e=>Q({...Y,price:e.target.value})})]})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(m.J,{htmlFor:"plan-description",children:el("plans.description")}),(0,a.jsx)(u.T,{id:"plan-description",value:Y.description,onChange:e=>Q({...Y,description:e.target.value})})]}),(0,a.jsxs)("div",{className:"grid grid-cols-3 gap-4",children:[(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(m.J,{htmlFor:"plan-currency",children:el("plans.currency")}),(0,a.jsxs)(c.l6,{value:Y.currency,onValueChange:e=>Q({...Y,currency:e}),children:[(0,a.jsx)(c.bq,{children:(0,a.jsx)(c.yv,{})}),(0,a.jsxs)(c.gC,{children:[(0,a.jsx)(c.eb,{value:"RUB",children:"RUB"}),(0,a.jsx)(c.eb,{value:"USD",children:"USD"}),(0,a.jsx)(c.eb,{value:"EUR",children:"EUR"})]})]})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(m.J,{htmlFor:"plan-interval",children:el("plans.interval")}),(0,a.jsxs)(c.l6,{value:Y.interval,onValueChange:e=>Q({...Y,interval:e}),children:[(0,a.jsx)(c.bq,{children:(0,a.jsx)(c.yv,{})}),(0,a.jsxs)(c.gC,{children:[(0,a.jsx)(c.eb,{value:"minute",children:"Minute"}),(0,a.jsx)(c.eb,{value:"hour",children:"Hour"}),(0,a.jsx)(c.eb,{value:"day",children:"Day"}),(0,a.jsx)(c.eb,{value:"week",children:"Week"}),(0,a.jsx)(c.eb,{value:"month",children:"Month"}),(0,a.jsx)(c.eb,{value:"year",children:"Year"})]})]})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(m.J,{htmlFor:"plan-interval-count",children:el("plans.count")}),(0,a.jsx)(p.p,{id:"plan-interval-count",type:"number",min:"1",value:Y.interval_count,onChange:e=>Q({...Y,interval_count:e.target.value})})]})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(m.J,{htmlFor:"plan-trial",children:el("plans.trialLabel")}),(0,a.jsx)(p.p,{id:"plan-trial",type:"number",min:"0",value:Y.trial_period_days,onChange:e=>Q({...Y,trial_period_days:e.target.value})})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(m.J,{htmlFor:"plan-features",children:el("plans.featuresJSON")}),(0,a.jsx)(u.T,{id:"plan-features",value:Y.features,onChange:e=>Q({...Y,features:e.target.value}),placeholder:'{"feature1": true, "feature2": "value"}'})]})]}),(0,a.jsxs)(d.Es,{children:[(0,a.jsx)(o.$,{variant:"outline",onClick:()=>$(!1),children:ed("cancel")}),(0,a.jsx)(o.$,{onClick:eC,children:el("plans.create")})]})]})}),(0,a.jsx)(d.lG,{open:z,onOpenChange:D,children:(0,a.jsxs)(d.Cf,{children:[(0,a.jsxs)(d.c7,{children:[(0,a.jsx)(d.L3,{children:el("subscriptions.create")}),(0,a.jsx)(d.rr,{children:el("subscriptions.createFor",{name:(null==G?void 0:G.name)||""})})]}),(0,a.jsxs)("div",{className:"space-y-4 py-2",children:[G&&(0,a.jsx)(l.Zp,{children:(0,a.jsx)(l.Wu,{className:"pt-4",children:(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsxs)("div",{className:"flex justify-between",children:[(0,a.jsx)("span",{children:"Plan:"}),(0,a.jsx)("span",{className:"font-medium",children:G.name})]}),(0,a.jsxs)("div",{className:"flex justify-between",children:[(0,a.jsx)("span",{children:"Price:"}),(0,a.jsxs)("span",{className:"font-medium",children:[G.price," ",G.currency]})]}),(0,a.jsxs)("div",{className:"flex justify-between",children:[(0,a.jsx)("span",{children:"Billing:"}),(0,a.jsxs)("span",{className:"font-medium",children:["Every ",eP(G.interval,G.interval_count)]})]})]})})}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(m.J,{htmlFor:"subscription-method",children:el("methods.title")}),(0,a.jsxs)(c.l6,{value:ee.method_id,onValueChange:e=>es({...ee,method_id:e}),children:[(0,a.jsx)(c.bq,{children:(0,a.jsx)(c.yv,{placeholder:"Select payment method"})}),(0,a.jsx)(c.gC,{children:null==eu?void 0:eu.filter(e=>e.is_recurrent_ready&&"active"===e.status).map(e=>{var s;return(0,a.jsxs)(c.eb,{value:e.id,children:[e.type," - ",e.provider.name," ",(null==(s=e.details)?void 0:s.pan)&&"(**** ".concat(e.details.pan,")")]},e.id)})})]})]})]}),(0,a.jsxs)(d.Es,{children:[(0,a.jsx)(o.$,{variant:"outline",onClick:()=>D(!1),children:ed("cancel")}),(0,a.jsx)(o.$,{onClick:eS,children:el("subscriptions.create")})]})]})}),(0,a.jsx)(d.lG,{open:I,onOpenChange:O,children:(0,a.jsxs)(d.Cf,{children:[(0,a.jsxs)(d.c7,{children:[(0,a.jsx)(d.L3,{children:el("operations.create")}),(0,a.jsx)(d.rr,{children:el("operations.createDescription")})]}),(0,a.jsxs)("div",{className:"space-y-4 py-2",children:[(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(m.J,{htmlFor:"payment-provider",children:el("providers.title")}),(0,a.jsxs)(c.l6,{value:(null==W?void 0:W.id)||"",onValueChange:e=>{Z((null==ep?void 0:ep.find(s=>s.id===e))||null)},children:[(0,a.jsx)(c.bq,{children:(0,a.jsx)(c.yv,{placeholder:"Select provider"})}),(0,a.jsx)(c.gC,{children:null==ep?void 0:ep.map(e=>(0,a.jsxs)(c.eb,{value:e.id,children:[e.name," (",e.is_test_mode?el("providers.test"):el("providers.prod"),")"]},e.id))})]})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(m.J,{htmlFor:"payment-amount",children:el("amount")}),(0,a.jsx)(p.p,{id:"payment-amount",type:"number",step:"0.01",value:et.amount,onChange:e=>ea({...et,amount:e.target.value})})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(m.J,{htmlFor:"payment-currency",children:el("plans.currency")}),(0,a.jsxs)(c.l6,{value:et.currency,onValueChange:e=>ea({...et,currency:e}),children:[(0,a.jsx)(c.bq,{children:(0,a.jsx)(c.yv,{})}),(0,a.jsxs)(c.gC,{children:[(0,a.jsx)(c.eb,{value:"RUB",children:"RUB"}),(0,a.jsx)(c.eb,{value:"USD",children:"USD"}),(0,a.jsx)(c.eb,{value:"EUR",children:"EUR"})]})]})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(m.J,{htmlFor:"payment-description",children:el("table.description")}),(0,a.jsx)(p.p,{id:"payment-description",value:et.description,onChange:e=>ea({...et,description:e.target.value})})]})]}),(0,a.jsxs)(d.Es,{children:[(0,a.jsx)(o.$,{variant:"outline",onClick:()=>O(!1),children:ed("cancel")}),(0,a.jsx)(o.$,{onClick:eF,children:el("operations.create")})]})]})})]}),(0,a.jsx)(f.l$,{})]})}}},e=>{var s=s=>e(e.s=s);e.O(0,[2115,5741,4358,5946,8893,5366,8441,1684,7358],()=>s(11952)),_N_E=e.O()}]);