(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[295],{20085:(e,s,l)=>{"use strict";l.d(s,{Messaging:()=>b});var a=l(95155),r=l(12115),t=l(88893),n=l(97168),i=l(99840),o=l(89852),c=l(82714),d=l(47655),u=l(53999);function m(e){let{className:s,children:l,...r}=e;return(0,a.jsxs)(d.bL,{"data-slot":"scroll-area",className:(0,u.cn)("relative",s),...r,children:[(0,a.jsx)(d.LM,{"data-slot":"scroll-area-viewport",className:"focus-visible:ring-ring/50 size-full rounded-[inherit] transition-[color,box-shadow] outline-none focus-visible:ring-[3px] focus-visible:outline-1",children:l}),(0,a.jsx)(h,{}),(0,a.jsx)(d.OK,{})]})}function h(e){let{className:s,orientation:l="vertical",...r}=e;return(0,a.jsx)(d.VM,{"data-slot":"scroll-area-scrollbar",orientation:l,className:(0,u.cn)("flex touch-none p-px transition-colors select-none","vertical"===l&&"h-full w-2.5 border-l border-l-transparent","horizontal"===l&&"h-2.5 flex-col border-t border-t-transparent",s),...r,children:(0,a.jsx)(d.lr,{"data-slot":"scroll-area-thumb",className:"bg-border relative flex-1 rounded-full"})})}var x=l(84616),_=l(81497),g=l(46292),j=l(17580),p=l(71007);function v(e){let{value:s,onValueChange:l,placeholder:n="Select users...",queryGenerator:i}=e,[o,c]=(0,r.useState)(""),[d,u]=(0,r.useState)("");(0,r.useEffect)(()=>{let e=setTimeout(()=>{u(o)},300);return()=>clearTimeout(e)},[o]);let m=(0,r.useMemo)(()=>i(d),[d,i]),{data:h=[],loading:x}=(0,t.IT)({...m},{skip:!1}),_=(0,r.useMemo)(()=>[{label:"All users",value:"user",icon:j.A,color:"0366d6"},{label:"Anonymous users",value:"anonymous",icon:p.A,color:"6b7280"},...h.map(e=>({label:e.name||"User ".concat(e.id),value:e.id,icon:p.A,color:"059669"}))],[h]);return(0,a.jsx)(g.K,{options:_,onValueChange:l,defaultValue:s,placeholder:n,animation:.3,maxCount:5,className:"w-full",onSearch:e=>{c(e)}})}var f=l(88145),w=l(99474),N=l(12486);function y(e){let{room:s}=e,l=(0,t.Dh)(),i=(0,t.c3)("messaging"),[o,c]=(0,r.useState)(""),[d,u]=(0,r.useState)(!1),{data:h=[],loading:x}=(0,t.Rs)({table:"messages",where:{replies:{room_id:{_eq:s.id}}},returning:["id","value","user_id","created_at","updated_at"],order_by:[{created_at:"asc"}]}),{data:g=[]}=(0,t.IT)({table:"users",where:{},returning:["id","name"]}),j=e=>{let s=g.find(s=>s.id===e);return(null==s?void 0:s.name)||"User ".concat(e)},p=async()=>{if(o.trim()){u(!0);try{let e=crypto.randomUUID(),a=await l.insert({table:"messages",object:{id:e,value:o.trim()},returning:["id","value","user_id"]}),r=crypto.randomUUID();await l.insert({table:"replies",object:{id:r,message_id:e,room_id:s.id},returning:["id"]}),console.log("✅ Message sent:",a),c("")}catch(e){console.error("❌ Error sending message:",e)}finally{u(!1)}}};return(0,a.jsxs)("div",{className:"h-full flex flex-col",children:[(0,a.jsx)("div",{className:"p-4 border-b",children:(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("h1",{className:"text-xl font-bold",children:s.title}),(0,a.jsx)("p",{className:"text-sm text-muted-foreground",children:i("createdAt",{date:new Date(s.created_at).toLocaleDateString()})})]}),(0,a.jsx)("div",{className:"flex items-center space-x-2",children:(0,a.jsxs)(f.E,{variant:"secondary",children:[(0,a.jsx)(_.A,{className:"w-3 h-3 mr-1"}),i("messagesCount",{count:h.length})]})})]})}),(0,a.jsxs)("div",{className:"flex-1 flex flex-col",children:[(0,a.jsx)(m,{className:"flex-1 p-4",children:x?(0,a.jsx)("div",{className:"text-center py-8 text-muted-foreground",children:i("loadingMessages")}):0===h.length?(0,a.jsxs)("div",{className:"text-center py-8 text-muted-foreground",children:[(0,a.jsx)(_.A,{className:"w-12 h-12 mx-auto mb-4 opacity-50"}),(0,a.jsx)("p",{children:i("noMessages")}),(0,a.jsx)("p",{className:"text-sm",children:i("startConversation")})]}):(0,a.jsx)("div",{className:"space-y-4",children:h.map(e=>(0,a.jsx)("div",{className:"flex flex-col space-y-1",children:(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,a.jsx)("div",{className:"w-8 h-8 bg-primary rounded-full flex items-center justify-center text-primary-foreground text-sm font-medium",children:j(e.user_id).charAt(0).toUpperCase()}),(0,a.jsxs)("div",{className:"flex-1",children:[(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,a.jsx)("span",{className:"font-medium text-sm",children:j(e.user_id)}),(0,a.jsx)("span",{className:"text-xs text-muted-foreground",children:new Date(e.created_at).toLocaleTimeString()})]}),(0,a.jsx)("div",{className:"mt-1 p-3 bg-muted rounded-lg",children:e.value})]})]})},e.id))})}),(0,a.jsx)("div",{className:"p-4 border-t bg-background",children:(0,a.jsxs)("div",{className:"flex space-x-2",children:[(0,a.jsx)(w.T,{placeholder:i("enterMessage"),value:o,onChange:e=>c(e.target.value),onKeyPress:e=>{"Enter"!==e.key||e.shiftKey||(e.preventDefault(),p())},className:"flex-1 min-h-[60px] max-h-[120px] resize-none",disabled:d}),(0,a.jsx)(n.$,{onClick:p,disabled:!o.trim()||d,className:"self-end",children:(0,a.jsx)(N.A,{className:"w-4 h-4"})})]})})]})]})}function b(){let e=(0,t.Dh)(),s=(0,t.c3)("messaging"),l=(0,t.c3)("actions"),[d,u]=(0,r.useState)(null),[h,g]=(0,r.useState)(!1),[j,p]=(0,r.useState)({title:"",allow_select_users:[],allow_change_users:[],allow_reply_users:[],allow_remove_users:[],allow_delete_users:[]}),{data:f=[],loading:w}=(0,t.Rs)({table:"rooms",where:{},returning:["id","title","user_id","allow_select_users","allow_change_users","allow_reply_users","allow_remove_users","allow_delete_users","created_at","updated_at"],order_by:[{updated_at:"desc"}]}),[N,b]=(0,r.useState)(!1),C=async()=>{if(!j.title.trim())return void console.error("❌ Room title is required");b(!0);try{let s=await e.insert({table:"rooms",object:{id:crypto.randomUUID(),title:j.title,allow_select_users:j.allow_select_users,allow_change_users:j.allow_change_users,allow_reply_users:j.allow_reply_users,allow_remove_users:j.allow_remove_users,allow_delete_users:j.allow_delete_users},returning:["id","title","user_id","created_at"]});console.log("✅ Room created:",s),g(!1),p({title:"",allow_select_users:[],allow_change_users:[],allow_reply_users:[],allow_remove_users:[],allow_delete_users:[]})}catch(e){console.error("❌ Error creating room:",e)}finally{b(!1)}},k=(e,s)=>{p(l=>({...l,[e]:s}))};return(0,a.jsxs)("div",{className:"flex h-full",children:[(0,a.jsxs)("div",{className:"w-[300px] border-r flex flex-col",children:[(0,a.jsx)("div",{className:"p-4 border-b",children:(0,a.jsxs)(i.lG,{open:h,onOpenChange:g,children:[(0,a.jsx)(i.zM,{asChild:!0,children:(0,a.jsxs)(n.$,{className:"w-full",size:"sm",children:[(0,a.jsx)(x.A,{className:"w-4 h-4 mr-2"}),s("createRoom")]})}),(0,a.jsxs)(i.Cf,{className:"sm:max-w-[500px]",children:[(0,a.jsx)(i.c7,{children:(0,a.jsx)(i.L3,{children:s("createNewRoom")})}),(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(c.J,{htmlFor:"room-title",children:s("roomTitle")}),(0,a.jsx)(o.p,{id:"room-title",placeholder:s("enterRoomTitle"),value:j.title,onChange:e=>k("title",e.target.value)})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(c.J,{children:s("whoCanView")}),(0,a.jsx)(v,{value:j.allow_select_users,onValueChange:e=>k("allow_select_users",e),placeholder:s("selectUsers"),queryGenerator:e=>({table:"users",where:e&&e.length>=2?{name:{_ilike:"%".concat(e,"%")}}:{},returning:["id","name"],limit:e&&e.length>=2?10:50})})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(c.J,{children:s("whoCanEdit")}),(0,a.jsx)(v,{value:j.allow_change_users,onValueChange:e=>k("allow_change_users",e),placeholder:s("selectUsers"),queryGenerator:e=>({table:"users",where:e&&e.length>=2?{name:{_ilike:"%".concat(e,"%")}}:{},returning:["id","name"],limit:e&&e.length>=2?10:50})})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(c.J,{children:s("whoCanReply")}),(0,a.jsx)(v,{value:j.allow_reply_users,onValueChange:e=>k("allow_reply_users",e),placeholder:s("selectUsers"),queryGenerator:e=>({table:"users",where:e&&e.length>=2?{name:{_ilike:"%".concat(e,"%")}}:{},returning:["id","name"],limit:e&&e.length>=2?10:50})})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(c.J,{children:s("whoCanRemoveOwn")}),(0,a.jsx)(v,{value:j.allow_remove_users,onValueChange:e=>k("allow_remove_users",e),placeholder:s("selectUsers"),queryGenerator:e=>({table:"users",where:e&&e.length>=2?{name:{_ilike:"%".concat(e,"%")}}:{},returning:["id","name"],limit:e&&e.length>=2?10:50})})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(c.J,{children:s("whoCanDeleteAny")}),(0,a.jsx)(v,{value:j.allow_delete_users,onValueChange:e=>k("allow_delete_users",e),placeholder:s("selectUsers"),queryGenerator:e=>({table:"users",where:e&&e.length>=2?{name:{_ilike:"%".concat(e,"%")}}:{},returning:["id","name"],limit:e&&e.length>=2?10:50})})]})]}),(0,a.jsxs)("div",{className:"flex justify-end space-x-2 pt-4",children:[(0,a.jsx)(n.$,{variant:"outline",onClick:()=>g(!1),children:l("cancel")}),(0,a.jsx)(n.$,{onClick:C,disabled:N,children:N?s("creating"):l("create")})]})]})]})}),(0,a.jsx)(m,{className:"flex-1",children:(0,a.jsx)("div",{className:"p-2 space-y-1",children:w?(0,a.jsx)("div",{className:"text-center py-4 text-muted-foreground",children:s("loadingRooms")}):0===f.length?(0,a.jsx)("div",{className:"text-center py-4 text-muted-foreground",children:s("noRooms")}):f.map(e=>(0,a.jsxs)("div",{className:"p-3 rounded-lg cursor-pointer transition-colors ".concat((null==d?void 0:d.id)===e.id?"bg-primary text-primary-foreground":"hover:bg-muted"),onClick:()=>u(e),children:[(0,a.jsx)("div",{className:"font-medium",children:e.title}),(0,a.jsx)("div",{className:"text-sm text-muted-foreground",children:new Date(e.updated_at).toLocaleDateString(void 0,{year:"numeric",month:"short",day:"numeric"})})]},e.id))})})]}),(0,a.jsx)("div",{className:"flex-1",children:d?(0,a.jsx)(y,{room:d}):(0,a.jsx)("div",{className:"flex items-center justify-center h-full text-muted-foreground",children:(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsx)(_.A,{className:"w-12 h-12 mx-auto mb-4 opacity-50"}),(0,a.jsx)("p",{children:s("selectRoomToView")})]})})})]})}},54923:(e,s,l)=>{Promise.resolve().then(l.bind(l,20085)),Promise.resolve().then(l.bind(l,55366))}},e=>{var s=s=>e(e.s=s);e.O(0,[2115,5741,6125,6438,8893,5366,6292,8441,1684,7358],()=>s(54923)),_N_E=e.O()}]);