(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[295],{16891:(e,s,l)=>{"use strict";l.d(s,{F:()=>n});var a=l(95155);l(12115);var r=l(47655),t=l(53999);function n(e){let{className:s,children:l,...n}=e;return(0,a.jsxs)(r.bL,{"data-slot":"scroll-area",className:(0,t.cn)("relative",s),...n,children:[(0,a.jsx)(r.LM,{"data-slot":"scroll-area-viewport",className:"focus-visible:ring-ring/50 size-full rounded-[inherit] transition-[color,box-shadow] outline-none focus-visible:ring-[3px] focus-visible:outline-1",children:l}),(0,a.jsx)(i,{}),(0,a.jsx)(r.OK,{})]})}function i(e){let{className:s,orientation:l="vertical",...n}=e;return(0,a.jsx)(r.VM,{"data-slot":"scroll-area-scrollbar",orientation:l,className:(0,t.cn)("flex touch-none p-px transition-colors select-none","vertical"===l&&"h-full w-2.5 border-l border-l-transparent","horizontal"===l&&"h-2.5 flex-col border-t border-t-transparent",s),...n,children:(0,a.jsx)(r.lr,{"data-slot":"scroll-area-thumb",className:"bg-border relative flex-1 rounded-full"})})}},27343:(e,s,l)=>{"use strict";l.d(s,{Messaging:()=>v});var a=l(95155),r=l(12115),t=l(88893),n=l(97168),i=l(99840),c=l(89852),o=l(82714),d=l(16891),u=l(84616),m=l(81497),h=l(65823),x=l(88145),_=l(99474);let p=(0,l(19946).A)("send",[["path",{d:"M14.536 21.686a.5.5 0 0 0 .937-.024l6.5-19a.496.496 0 0 0-.635-.635l-19 6.5a.5.5 0 0 0-.024.937l7.93 3.18a2 2 0 0 1 1.112 1.11z",key:"1ffxy3"}],["path",{d:"m21.854 2.147-10.94 10.939",key:"12cjpa"}]]);function g(e){let{room:s}=e,l=(0,t.Dh)(),i=(0,t.c3)("messaging"),[c,o]=(0,r.useState)(""),[u,h]=(0,r.useState)(!1),{data:g=[],loading:v}=(0,t.Rs)({table:"messages",where:{replies:{room_id:{_eq:s.id}}},returning:["id","value","user_id","created_at","updated_at"],order_by:[{created_at:"asc"}]}),{data:j=[]}=(0,t.IT)({table:"users",where:{},returning:["id","name"]}),f=e=>{let s=j.find(s=>s.id===e);return(null==s?void 0:s.name)||"User ".concat(e)},w=async()=>{if(c.trim()){h(!0);try{let e=crypto.randomUUID(),a=await l.insert({table:"messages",object:{id:e,value:c.trim()},returning:["id","value","user_id"]}),r=crypto.randomUUID();await l.insert({table:"replies",object:{id:r,message_id:e,room_id:s.id},returning:["id"]}),console.log("✅ Message sent:",a),o("")}catch(e){console.error("❌ Error sending message:",e)}finally{h(!1)}}};return(0,a.jsxs)("div",{className:"h-full flex flex-col",children:[(0,a.jsx)("div",{className:"p-4 border-b",children:(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("h1",{className:"text-xl font-bold",children:s.title}),(0,a.jsx)("p",{className:"text-sm text-muted-foreground",children:i("createdAt",{date:new Date(s.created_at).toLocaleDateString()})})]}),(0,a.jsx)("div",{className:"flex items-center space-x-2",children:(0,a.jsxs)(x.E,{variant:"secondary",children:[(0,a.jsx)(m.A,{className:"w-3 h-3 mr-1"}),i("messagesCount",{count:g.length})]})})]})}),(0,a.jsxs)("div",{className:"flex-1 flex flex-col",children:[(0,a.jsx)(d.F,{className:"flex-1 p-4",children:v?(0,a.jsx)("div",{className:"text-center py-8 text-muted-foreground",children:i("loadingMessages")}):0===g.length?(0,a.jsxs)("div",{className:"text-center py-8 text-muted-foreground",children:[(0,a.jsx)(m.A,{className:"w-12 h-12 mx-auto mb-4 opacity-50"}),(0,a.jsx)("p",{children:i("noMessages")}),(0,a.jsx)("p",{className:"text-sm",children:i("startConversation")})]}):(0,a.jsx)("div",{className:"space-y-4",children:g.map(e=>(0,a.jsx)("div",{className:"flex flex-col space-y-1",children:(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,a.jsx)("div",{className:"w-8 h-8 bg-primary rounded-full flex items-center justify-center text-primary-foreground text-sm font-medium",children:f(e.user_id).charAt(0).toUpperCase()}),(0,a.jsxs)("div",{className:"flex-1",children:[(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,a.jsx)("span",{className:"font-medium text-sm",children:f(e.user_id)}),(0,a.jsx)("span",{className:"text-xs text-muted-foreground",children:new Date(e.created_at).toLocaleTimeString()})]}),(0,a.jsx)("div",{className:"mt-1 p-3 bg-muted rounded-lg",children:e.value})]})]})},e.id))})}),(0,a.jsx)("div",{className:"p-4 border-t bg-background",children:(0,a.jsxs)("div",{className:"flex space-x-2",children:[(0,a.jsx)(_.T,{placeholder:i("enterMessage"),value:c,onChange:e=>o(e.target.value),onKeyPress:e=>{"Enter"!==e.key||e.shiftKey||(e.preventDefault(),w())},className:"flex-1 min-h-[60px] max-h-[120px] resize-none",disabled:u}),(0,a.jsx)(n.$,{onClick:w,disabled:!c.trim()||u,className:"self-end",children:(0,a.jsx)(p,{className:"w-4 h-4"})})]})})]})]})}function v(){let e=(0,t.Dh)(),s=(0,t.c3)("messaging"),l=(0,t.c3)("actions"),[x,_]=(0,r.useState)(null),[p,v]=(0,r.useState)(!1),[j,f]=(0,r.useState)({title:"",allow_select_users:[],allow_change_users:[],allow_reply_users:[],allow_remove_users:[],allow_delete_users:[]}),{data:w=[],loading:N}=(0,t.Rs)({table:"rooms",where:{},returning:["id","title","user_id","allow_select_users","allow_change_users","allow_reply_users","allow_remove_users","allow_delete_users","created_at","updated_at"],order_by:[{updated_at:"desc"}]}),[y,b]=(0,r.useState)(!1),C=async()=>{if(!j.title.trim())return void console.error("❌ Room title is required");b(!0);try{let s=await e.insert({table:"rooms",object:{id:crypto.randomUUID(),title:j.title,allow_select_users:j.allow_select_users,allow_change_users:j.allow_change_users,allow_reply_users:j.allow_reply_users,allow_remove_users:j.allow_remove_users,allow_delete_users:j.allow_delete_users},returning:["id","title","user_id","created_at"]});console.log("✅ Room created:",s),v(!1),f({title:"",allow_select_users:[],allow_change_users:[],allow_reply_users:[],allow_remove_users:[],allow_delete_users:[]})}catch(e){console.error("❌ Error creating room:",e)}finally{b(!1)}},k=(e,s)=>{f(l=>({...l,[e]:s}))};return(0,a.jsxs)("div",{className:"flex h-full",children:[(0,a.jsxs)("div",{className:"w-[300px] border-r flex flex-col",children:[(0,a.jsx)("div",{className:"p-4 border-b",children:(0,a.jsxs)(i.lG,{open:p,onOpenChange:v,children:[(0,a.jsx)(i.zM,{asChild:!0,children:(0,a.jsxs)(n.$,{className:"w-full",size:"sm",children:[(0,a.jsx)(u.A,{className:"w-4 h-4 mr-2"}),s("createRoom")]})}),(0,a.jsxs)(i.Cf,{className:"sm:max-w-[500px]",children:[(0,a.jsx)(i.c7,{children:(0,a.jsx)(i.L3,{children:s("createNewRoom")})}),(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(o.J,{htmlFor:"room-title",children:s("roomTitle")}),(0,a.jsx)(c.p,{id:"room-title",placeholder:s("enterRoomTitle"),value:j.title,onChange:e=>k("title",e.target.value)})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(o.J,{children:s("whoCanView")}),(0,a.jsx)(h.v,{value:j.allow_select_users,onValueChange:e=>k("allow_select_users",e),placeholder:s("selectUsers"),queryGenerator:e=>({table:"users",where:e&&e.length>=2?{name:{_ilike:"%".concat(e,"%")}}:{},returning:["id","name"],limit:e&&e.length>=2?10:50})})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(o.J,{children:s("whoCanEdit")}),(0,a.jsx)(h.v,{value:j.allow_change_users,onValueChange:e=>k("allow_change_users",e),placeholder:s("selectUsers"),queryGenerator:e=>({table:"users",where:e&&e.length>=2?{name:{_ilike:"%".concat(e,"%")}}:{},returning:["id","name"],limit:e&&e.length>=2?10:50})})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(o.J,{children:s("whoCanReply")}),(0,a.jsx)(h.v,{value:j.allow_reply_users,onValueChange:e=>k("allow_reply_users",e),placeholder:s("selectUsers"),queryGenerator:e=>({table:"users",where:e&&e.length>=2?{name:{_ilike:"%".concat(e,"%")}}:{},returning:["id","name"],limit:e&&e.length>=2?10:50})})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(o.J,{children:s("whoCanRemoveOwn")}),(0,a.jsx)(h.v,{value:j.allow_remove_users,onValueChange:e=>k("allow_remove_users",e),placeholder:s("selectUsers"),queryGenerator:e=>({table:"users",where:e&&e.length>=2?{name:{_ilike:"%".concat(e,"%")}}:{},returning:["id","name"],limit:e&&e.length>=2?10:50})})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(o.J,{children:s("whoCanDeleteAny")}),(0,a.jsx)(h.v,{value:j.allow_delete_users,onValueChange:e=>k("allow_delete_users",e),placeholder:s("selectUsers"),queryGenerator:e=>({table:"users",where:e&&e.length>=2?{name:{_ilike:"%".concat(e,"%")}}:{},returning:["id","name"],limit:e&&e.length>=2?10:50})})]})]}),(0,a.jsxs)("div",{className:"flex justify-end space-x-2 pt-4",children:[(0,a.jsx)(n.$,{variant:"outline",onClick:()=>v(!1),children:l("cancel")}),(0,a.jsx)(n.$,{onClick:C,disabled:y,children:y?s("creating"):l("create")})]})]})]})}),(0,a.jsx)(d.F,{className:"flex-1",children:(0,a.jsx)("div",{className:"p-2 space-y-1",children:N?(0,a.jsx)("div",{className:"text-center py-4 text-muted-foreground",children:s("loadingRooms")}):0===w.length?(0,a.jsx)("div",{className:"text-center py-4 text-muted-foreground",children:s("noRooms")}):w.map(e=>(0,a.jsxs)("div",{className:"p-3 rounded-lg cursor-pointer transition-colors ".concat((null==x?void 0:x.id)===e.id?"bg-primary text-primary-foreground":"hover:bg-muted"),onClick:()=>_(e),children:[(0,a.jsx)("div",{className:"font-medium",children:e.title}),(0,a.jsx)("div",{className:"text-sm text-muted-foreground",children:new Date(e.updated_at).toLocaleDateString(void 0,{year:"numeric",month:"short",day:"numeric"})})]},e.id))})})]}),(0,a.jsx)("div",{className:"flex-1",children:x?(0,a.jsx)(g,{room:x}):(0,a.jsx)("div",{className:"flex items-center justify-center h-full text-muted-foreground",children:(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsx)(m.A,{className:"w-12 h-12 mx-auto mb-4 opacity-50"}),(0,a.jsx)("p",{children:s("selectRoomToView")})]})})})]})}},54923:(e,s,l)=>{Promise.resolve().then(l.bind(l,27343)),Promise.resolve().then(l.bind(l,55366))},65823:(e,s,l)=>{"use strict";l.d(s,{v:()=>o});var a=l(95155),r=l(12115),t=l(88893),n=l(46292),i=l(17580),c=l(71007);function o(e){let{value:s,onValueChange:l,placeholder:o="Select users...",queryGenerator:d}=e,[u,m]=(0,r.useState)(""),[h,x]=(0,r.useState)("");(0,r.useEffect)(()=>{let e=setTimeout(()=>{x(u)},300);return()=>clearTimeout(e)},[u]);let _=(0,r.useMemo)(()=>d(h),[h,d]),{data:p=[],loading:g}=(0,t.IT)({..._},{skip:!1}),v=(0,r.useMemo)(()=>[{label:"All users",value:"user",icon:i.A,color:"0366d6"},{label:"Anonymous users",value:"anonymous",icon:c.A,color:"6b7280"},...p.map(e=>({label:e.name||"User ".concat(e.id),value:e.id,icon:c.A,color:"059669"}))],[p]);return(0,a.jsx)(n.K,{options:v,onValueChange:l,defaultValue:s,placeholder:o,animation:.3,maxCount:5,className:"w-full",onSearch:e=>{m(e)}})}}},e=>{var s=s=>e(e.s=s);e.O(0,[2115,5741,5822,9660,8893,5366,6292,8441,1684,7358],()=>s(54923)),_N_E=e.O()}]);