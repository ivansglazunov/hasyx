(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[1189],{16891:(e,s,l)=>{"use strict";l.d(s,{F:()=>t});var i=l(95155);l(12115);var a=l(47655),r=l(53999);function t(e){let{className:s,children:l,...t}=e;return(0,i.jsxs)(a.bL,{"data-slot":"scroll-area",className:(0,r.cn)("relative",s),...t,children:[(0,i.jsx)(a.LM,{"data-slot":"scroll-area-viewport",className:"focus-visible:ring-ring/50 size-full rounded-[inherit] transition-[color,box-shadow] outline-none focus-visible:ring-[3px] focus-visible:outline-1",children:l}),(0,i.jsx)(n,{}),(0,i.jsx)(a.OK,{})]})}function n(e){let{className:s,orientation:l="vertical",...t}=e;return(0,i.jsx)(a.VM,{"data-slot":"scroll-area-scrollbar",orientation:l,className:(0,r.cn)("flex touch-none p-px transition-colors select-none","vertical"===l&&"h-full w-2.5 border-l border-l-transparent","horizontal"===l&&"h-2.5 flex-col border-t border-t-transparent",s),...t,children:(0,i.jsx)(a.lr,{"data-slot":"scroll-area-thumb",className:"bg-border relative flex-1 rounded-full"})})}},25848:(e,s,l)=>{"use strict";l.r(s),l.d(s,{default:()=>v});var i=l(95155),a=l(12115),r=l(59918),t=l(80239),n=l(55366),o=l(88893),u=l(16891),c=l(97168),d=l(99840),h=l(89852),_=l(82714),p=l(65823),m=l(84616),x=l(51368);function v(){var e;let s=(0,o.Dh)(),v=a.useMemo(()=>new(l(42263)).Z(s),[s]),[g,w]=(0,a.useState)(null),[j,b]=(0,a.useState)(!1),[y,N]=(0,a.useState)(!1),[f,C]=(0,a.useState)(null),[q,k]=(0,a.useState)({title:"",visibility:"public",join_policy:"by_request",allow_view_users:[],allow_invite_users:[],allow_manage_members_users:[],allow_update_group_users:[],allow_delete_group_users:[],allow_request_users:[],allow_join_users:[]}),{data:S,loading:G,error:M,refetch:J}=(0,o.IT)({table:"groups",returning:["id","title","owner_id","visibility","join_policy","updated_at",{memberships:["id","user_id","role","status"]}],limit:100,order_by:{updated_at:"desc"}}),V=(0,a.useMemo)(()=>S||[],[S]),z=(0,a.useMemo)(()=>V.find(e=>e.id===g)||V[0],[V,g]),A=(e,s)=>{k(l=>({...l,[e]:s}))},O=async()=>{if(q.title.trim()){N(!0);try{C(null);let e=(0,x.A)();await v.createGroup({id:e,title:q.title,visibility:q.visibility,join_policy:q.join_policy});let s={allow_view_users:q.allow_view_users,allow_invite_users:q.allow_invite_users,allow_manage_members_users:q.allow_manage_members_users,allow_update_group_users:q.allow_update_group_users,allow_delete_group_users:q.allow_delete_group_users,allow_request_users:q.allow_request_users,allow_join_users:q.allow_join_users};(s.allow_view_users.length||s.allow_invite_users.length||s.allow_manage_members_users.length||s.allow_update_group_users.length||s.allow_delete_group_users.length||s.allow_request_users.length||s.allow_join_users.length)&&await v.updateGroup(e,s),b(!1),k({title:"",visibility:"public",join_policy:"by_request",allow_view_users:[],allow_invite_users:[],allow_manage_members_users:[],allow_update_group_users:[],allow_delete_group_users:[],allow_request_users:[],allow_join_users:[]}),await J()}finally{N(!1)}}};return(0,i.jsx)(n.SidebarLayout,{sidebarData:r.A,breadcrumb:[{title:t.UU,link:"/"}],children:(0,i.jsxs)("div",{className:"flex h-full",children:[(0,i.jsxs)("div",{className:"w-[300px] border-r flex flex-col",children:[(0,i.jsx)("div",{className:"p-4 border-b",children:(0,i.jsxs)(d.lG,{open:j,onOpenChange:b,children:[(0,i.jsx)(d.zM,{asChild:!0,children:(0,i.jsxs)(c.$,{className:"w-full",size:"sm",children:[(0,i.jsx)(m.A,{className:"w-4 h-4 mr-2"}),"Create Group"]})}),(0,i.jsxs)(d.Cf,{className:"sm:max-w-[500px]",children:[(0,i.jsx)(d.c7,{children:(0,i.jsx)(d.L3,{children:"Create New Group"})}),(0,i.jsxs)("div",{className:"space-y-4",children:[(0,i.jsxs)("div",{className:"space-y-2",children:[(0,i.jsx)(_.J,{htmlFor:"group-title",children:"Title"}),(0,i.jsx)(h.p,{id:"group-title",placeholder:"Enter group title",value:q.title,onChange:e=>A("title",e.target.value)})]}),(0,i.jsxs)("div",{className:"space-y-2",children:[(0,i.jsx)(_.J,{children:"Visibility"}),(0,i.jsxs)("select",{className:"border px-3 py-2 rounded w-full",value:q.visibility,onChange:e=>A("visibility",e.target.value),children:[(0,i.jsx)("option",{value:"public",children:"public"}),(0,i.jsx)("option",{value:"private",children:"private"}),(0,i.jsx)("option",{value:"secret",children:"secret"})]})]}),(0,i.jsxs)("div",{className:"space-y-2",children:[(0,i.jsx)(_.J,{children:"Join policy"}),(0,i.jsxs)("select",{className:"border px-3 py-2 rounded w-full",value:q.join_policy,onChange:e=>A("join_policy",e.target.value),children:[(0,i.jsx)("option",{value:"open",children:"open"}),(0,i.jsx)("option",{value:"by_request",children:"by_request"}),(0,i.jsx)("option",{value:"invite_only",children:"invite_only"}),(0,i.jsx)("option",{value:"closed",children:"closed"})]})]}),(0,i.jsxs)("div",{className:"space-y-2",children:[(0,i.jsx)(_.J,{children:"Who can view"}),(0,i.jsx)(p.v,{value:q.allow_view_users,onValueChange:e=>A("allow_view_users",e),placeholder:"Select users",queryGenerator:e=>({table:"users",where:e&&e.length>=2?{name:{_ilike:"%".concat(e,"%")}}:{},returning:["id","name"],limit:e&&e.length>=2?10:50})})]}),(0,i.jsxs)("div",{className:"space-y-2",children:[(0,i.jsx)(_.J,{children:"Who can invite"}),(0,i.jsx)(p.v,{value:q.allow_invite_users,onValueChange:e=>A("allow_invite_users",e),placeholder:"Select users",queryGenerator:e=>({table:"users",where:e&&e.length>=2?{name:{_ilike:"%".concat(e,"%")}}:{},returning:["id","name"],limit:e&&e.length>=2?10:50})})]}),(0,i.jsxs)("div",{className:"space-y-2",children:[(0,i.jsx)(_.J,{children:"Who can manage members"}),(0,i.jsx)(p.v,{value:q.allow_manage_members_users,onValueChange:e=>A("allow_manage_members_users",e),placeholder:"Select users",queryGenerator:e=>({table:"users",where:e&&e.length>=2?{name:{_ilike:"%".concat(e,"%")}}:{},returning:["id","name"],limit:e&&e.length>=2?10:50})})]}),(0,i.jsxs)("div",{className:"space-y-2",children:[(0,i.jsx)(_.J,{children:"Who can update group"}),(0,i.jsx)(p.v,{value:q.allow_update_group_users,onValueChange:e=>A("allow_update_group_users",e),placeholder:"Select users",queryGenerator:e=>({table:"users",where:e&&e.length>=2?{name:{_ilike:"%".concat(e,"%")}}:{},returning:["id","name"],limit:e&&e.length>=2?10:50})})]}),(0,i.jsxs)("div",{className:"space-y-2",children:[(0,i.jsx)(_.J,{children:"Who can delete group"}),(0,i.jsx)(p.v,{value:q.allow_delete_group_users,onValueChange:e=>A("allow_delete_group_users",e),placeholder:"Select users",queryGenerator:e=>({table:"users",where:e&&e.length>=2?{name:{_ilike:"%".concat(e,"%")}}:{},returning:["id","name"],limit:e&&e.length>=2?10:50})})]}),(0,i.jsxs)("div",{className:"space-y-2",children:[(0,i.jsx)(_.J,{children:"Who can request"}),(0,i.jsx)(p.v,{value:q.allow_request_users,onValueChange:e=>A("allow_request_users",e),placeholder:"Select users",queryGenerator:e=>({table:"users",where:e&&e.length>=2?{name:{_ilike:"%".concat(e,"%")}}:{},returning:["id","name"],limit:e&&e.length>=2?10:50})})]}),(0,i.jsxs)("div",{className:"space-y-2",children:[(0,i.jsx)(_.J,{children:"Who can join immediately"}),(0,i.jsx)(p.v,{value:q.allow_join_users,onValueChange:e=>A("allow_join_users",e),placeholder:"Select users",queryGenerator:e=>({table:"users",where:e&&e.length>=2?{name:{_ilike:"%".concat(e,"%")}}:{},returning:["id","name"],limit:e&&e.length>=2?10:50})})]}),(0,i.jsxs)("div",{className:"flex justify-end space-x-2 pt-2",children:[(0,i.jsx)(c.$,{variant:"outline",onClick:()=>b(!1),children:"Cancel"}),(0,i.jsx)(c.$,{onClick:O,disabled:y,children:y?"Creating…":"Create"})]}),f&&(0,i.jsx)("div",{className:"text-sm text-red-600",children:f}),!f&&(0,i.jsx)("div",{className:"text-xs text-muted-foreground",children:"Note: creating a group requires a valid signed-in user record."})]})]})]})}),(0,i.jsx)(u.F,{className:"flex-1",children:(0,i.jsx)("div",{className:"p-2 space-y-1",children:G?(0,i.jsx)("div",{className:"text-center py-4 text-muted-foreground",children:"Loading…"}):0===V.length?(0,i.jsx)("div",{className:"text-center py-4 text-muted-foreground",children:"No groups"}):V.map(e=>(0,i.jsxs)("div",{className:"p-3 rounded-lg cursor-pointer transition-colors ".concat((null==z?void 0:z.id)===e.id?"bg-primary text-primary-foreground":"hover:bg-muted"),onClick:()=>w(e.id),children:[(0,i.jsx)("div",{className:"font-medium",children:e.title}),(0,i.jsxs)("div",{className:"text-sm text-muted-foreground",children:[e.visibility," \xb7 ",e.join_policy]})]},e.id))})})]}),(0,i.jsxs)("div",{className:"flex-1 p-4 flex flex-col gap-4",children:[!z&&(0,i.jsx)("div",{className:"text-gray-500",children:"Select a group…"}),z&&(0,i.jsxs)(i.Fragment,{children:[(0,i.jsxs)("div",{className:"space-y-2",children:[(0,i.jsx)("div",{className:"text-xl font-medium",children:z.title}),(0,i.jsxs)("div",{className:"text-sm text-gray-600",children:["Owner: ",z.owner_id||"—"," \xb7 Visibility: ",z.visibility," \xb7 Join: ",z.join_policy]}),(0,i.jsxs)("div",{className:"flex gap-2",children:[(0,i.jsx)(c.$,{variant:"outline",size:"sm",onClick:async()=>{let e=prompt("New title",z.title)||z.title;await v.updateGroup(z.id,{title:e}),await J()},children:"Rename"}),(0,i.jsx)(c.$,{variant:"outline",size:"sm",onClick:async()=>{await v.deleteGroup(z.id),w(null),await J()},children:"Delete"})]})]}),(0,i.jsxs)("div",{className:"flex-1 overflow-auto border rounded p-3 space-y-3",children:[(0,i.jsxs)("div",{className:"font-medium",children:["Members (",(null==(e=z.memberships)?void 0:e.length)||0,")"]}),(0,i.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-3",children:(z.memberships||[]).map(e=>(0,i.jsxs)("div",{className:"border rounded p-3 space-y-2",children:[(0,i.jsxs)("div",{className:"text-sm",children:["User: ",e.user_id]}),(0,i.jsxs)("div",{className:"text-sm",children:["Role: ",e.role," \xb7 Status: ",e.status]}),(0,i.jsxs)("div",{className:"flex gap-2",children:[(0,i.jsx)(c.$,{variant:"outline",size:"sm",onClick:async()=>{await v.changeMemberRole(z.id,e.user_id,"admin"),await J()},children:"Make admin"}),(0,i.jsx)(c.$,{variant:"outline",size:"sm",onClick:async()=>{await v.leaveMembership(e.id),await J()},children:"Set left"})]})]},e.id))})]})]})]})]})})}},42263:(e,s,l)=>{"use strict";l.d(s,{Z:()=>i});class i{async createGroup(e){let s={title:e.title};return e.id&&(s.id=e.id),e.visibility&&(s.visibility=e.visibility),e.join_policy&&(s.join_policy=e.join_policy),e.slug&&(s.slug=e.slug),this.hasyx.insert({table:"groups",object:s,returning:["id","owner_id","created_by_id"]})}async updateGroup(e,s){await this.hasyx.update({table:"groups",where:{id:{_eq:e}},_set:s})}async deleteGroup(e){await this.hasyx.delete({table:"groups",pk_columns:{id:e}})}async resignOwnership(e){await this.updateGroup(e,{owner_id:null})}async claimOwnership(e,s){await this.updateGroup(e,{owner_id:s})}async requestMembership(e,s){let l={group_id:e};return s&&(l.user_id=s),this.hasyx.insert({table:"memberships",object:l,returning:["id","status"]})}async approveMembership(e){await this.hasyx.update({table:"memberships",where:{id:{_eq:e}},_set:{status:"approved"}})}async denyMembership(e){await this.hasyx.update({table:"memberships",where:{id:{_eq:e}},_set:{status:"denied"}})}async leaveMembership(e){await this.hasyx.update({table:"memberships",where:{id:{_eq:e}},_set:{status:"left"}})}async addMember(e,s){let l=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"member",i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"approved";return this.hasyx.insert({table:"memberships",object:{group_id:e,user_id:s,role:l,status:i},returning:["id"]})}async changeMemberRole(e,s,l){return this.hasyx.update({table:"memberships",where:{group_id:{_eq:e},user_id:{_eq:s}},_set:{role:l},returning:["role"]})}async inviteUser(e,s){return this.hasyx.insert({table:"invitations",object:{group_id:e,invitee_user_id:s},returning:["id","status"]})}async acceptInvitation(e){await this.hasyx.update({table:"invitations",where:{id:{_eq:e}},_set:{status:"accepted"}})}constructor(e){this.hasyx=e}}},56583:(e,s,l)=>{Promise.resolve().then(l.bind(l,25848))},65823:(e,s,l)=>{"use strict";l.d(s,{v:()=>u});var i=l(95155),a=l(12115),r=l(88893),t=l(46292),n=l(17580),o=l(71007);function u(e){let{value:s,onValueChange:l,placeholder:u="Select users...",queryGenerator:c}=e,[d,h]=(0,a.useState)(""),[_,p]=(0,a.useState)("");(0,a.useEffect)(()=>{let e=setTimeout(()=>{p(d)},300);return()=>clearTimeout(e)},[d]);let m=(0,a.useMemo)(()=>c(_),[_,c]),{data:x=[],loading:v}=(0,r.IT)({...m},{skip:!1}),g=(0,a.useMemo)(()=>[{label:"All users",value:"user",icon:n.A,color:"0366d6"},{label:"Anonymous users",value:"anonymous",icon:o.A,color:"6b7280"},...x.map(e=>({label:e.name||"User ".concat(e.id),value:e.id,icon:o.A,color:"059669"}))],[x]);return(0,i.jsx)(t.K,{options:g,onValueChange:l,defaultValue:s,placeholder:u,animation:.3,maxCount:5,className:"w-full",onSearch:e=>{h(e)}})}}},e=>{var s=s=>e(e.s=s);e.O(0,[2115,5741,5822,9660,8893,5366,4499,9918,6292,8441,1684,7358],()=>s(56583)),_N_E=e.O()}]);