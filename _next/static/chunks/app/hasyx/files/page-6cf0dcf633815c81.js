(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[3404],{33487:(e,t,s)=>{Promise.resolve().then(s.bind(s,52058))},52058:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>v});var r=s(95155),a=s(12115),l=s(59918),i=s(80239),d=s(55366),n=s(88893),o=s(56671),c=s(53999);function m(e){let{children:t,onFilesSelected:s,onUploadComplete:l,onUploadError:i,accept:d,multiple:o=!1,disabled:m=!1,className:x,dragActiveClassName:u}=e,[p,h]=(0,a.useState)(!1),g=(0,a.useRef)(null),f=(0,n.c3)("files"),b=(0,a.useCallback)(async e=>{if(!e||0===e.length)return;let t=Array.from(e);if(s&&s(t),l)for(let e=0;e<t.length;e++){let s=t[e];try{let e=new FormData;e.append("file",s),e.append("isPublic","false");let t=await fetch("/api/files",{method:"POST",body:e});if(!t.ok)throw Error(f("status.error"));let r=await t.json();l(r.file.id)}catch(e){console.error("Upload error:",e),i&&i(f("status.error"))}}},[s,l,i]),v=(0,a.useCallback)(()=>{!m&&g.current&&g.current.click()},[m]),j=(0,a.useCallback)(e=>{e.preventDefault(),e.stopPropagation()},[]),N=(0,a.useCallback)(e=>{e.preventDefault(),e.stopPropagation(),e.dataTransfer.items&&e.dataTransfer.items.length>0&&h(!0)},[]),y=(0,a.useCallback)(e=>{e.preventDefault(),e.stopPropagation(),h(!1)},[]),w=(0,a.useCallback)(e=>{e.preventDefault(),e.stopPropagation(),h(!1),e.dataTransfer.files&&e.dataTransfer.files.length>0&&b(e.dataTransfer.files)},[b]);return(0,r.jsxs)("div",{className:(0,c.cn)("relative",p&&u,x),onDragEnter:N,onDragLeave:y,onDragOver:j,onDrop:w,onClick:v,role:"button",tabIndex:m?-1:0,children:[(0,r.jsx)("input",{ref:g,type:"file",multiple:o,accept:d,className:"hidden",onChange:e=>b(e.target.files),disabled:m}),t]})}var x=s(65521);let u=(0,x.v)((e,t)=>({uploadingFiles:[],addFile:t=>{let s=Math.random().toString(36).substr(2,9),r={id:s,name:t.name,size:t.size,progress:0,status:"uploading"};return e(e=>({uploadingFiles:[...e.uploadingFiles,r]})),s},updateProgress:(t,s)=>{e(e=>({uploadingFiles:e.uploadingFiles.map(e=>e.id===t?{...e,progress:s}:e)}))},completeUpload:(t,s)=>{e(e=>({uploadingFiles:e.uploadingFiles.map(e=>e.id===t?{...e,status:"completed",fileId:s}:e)}))},setError:(t,s)=>{e(e=>({uploadingFiles:e.uploadingFiles.map(e=>e.id===t?{...e,status:"error",error:s}:e)}))},removeFile:t=>{e(e=>({uploadingFiles:e.uploadingFiles.filter(e=>e.id!==t)}))},clearAll:()=>{e({uploadingFiles:[]})}}));function p(e){let{className:t,showCompleted:s=!0,onFileComplete:a,onRemove:l,renderRemoveButton:i}=e,d=(0,n.c3)("files"),{uploadingFiles:o,removeFile:m}=u(),x=s?o:o.filter(e=>"completed"!==e.status),p=e=>{if(0===e)return"0 Bytes";let t=Math.floor(Math.log(e)/Math.log(1024));return parseFloat((e/Math.pow(1024,t)).toFixed(2))+" "+["Bytes","KB","MB","GB"][t]},h=e=>e.startsWith("image/")?"\uD83D\uDDBC️":e.startsWith("video/")?"\uD83C\uDFA5":e.startsWith("audio/")?"\uD83C\uDFB5":e.includes("pdf")?"\uD83D\uDCC4":e.includes("text/")?"\uD83D\uDCDD":e.includes("application/")?"\uD83D\uDCE6":"\uD83D\uDCC1",g=e=>{switch(e){case"uploading":return"bg-blue-100 text-blue-800";case"completed":return"bg-green-100 text-green-800";case"error":return"bg-red-100 text-red-800";default:return"bg-gray-100 text-gray-800"}},f=e=>{switch(e){case"uploading":return d("status.uploading");case"completed":return d("status.completed");case"error":return d("status.error");default:return d("status.unknown")}};return 0===x.length?null:(0,r.jsx)("div",{className:(0,c.cn)("space-y-3",t),children:x.map(e=>(0,r.jsx)("div",{className:"bg-card rounded-lg border border-border p-4 hover:shadow-sm transition-shadow",children:(0,r.jsxs)("div",{className:"flex items-start justify-between",children:[(0,r.jsxs)("div",{className:"flex items-start space-x-3 flex-1 min-w-0",children:[(0,r.jsx)("div",{className:"text-2xl flex-shrink-0",children:h("application/octet-stream")}),(0,r.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,r.jsxs)("div",{className:"flex items-center space-x-2 mb-1",children:[(0,r.jsx)("h4",{className:"text-sm font-medium text-foreground truncate",children:e.name}),e.fileId&&(0,r.jsxs)("span",{className:"text-xs text-muted-foreground bg-muted px-2 py-1 rounded",children:["ID: ",e.fileId]})]}),(0,r.jsx)("div",{className:"text-xs text-muted-foreground mb-2",children:p(e.size)}),"uploading"===e.status&&(0,r.jsx)("div",{className:"w-full bg-muted rounded-full h-2 mb-2",children:(0,r.jsx)("div",{className:"bg-primary h-2 rounded-full transition-all duration-300",style:{width:"".concat(e.progress,"%")}})}),(0,r.jsx)("span",{className:(0,c.cn)("inline-flex px-2 py-1 text-xs font-semibold rounded-full",g(e.status)),children:f(e.status)}),"error"===e.status&&e.error&&(0,r.jsx)("div",{className:"text-xs text-red-600 mt-1",children:e.error})]})]}),i?i(e.id):(0,r.jsx)("button",{onClick:t=>{t.stopPropagation(),(null!=l?l:m)(e.id)},className:"text-muted-foreground hover:text-destructive transition-colors p-1",title:d("removeFile"),type:"button",children:"✕"})]})},e.id))})}var h=s(97168),g=s(87251);let f=(0,x.v)((e,t)=>({choose:void 0,setChoose:t=>{e({choose:t})},toggleChoose:s=>{let{choose:r}=t();if(r){let t=r.includes(s)?r.filter(e=>e!==s):[...r,s];e({choose:t.length>0?t:void 0})}else e({choose:[s]})},addChoose:s=>{let{choose:r}=t();r?r.includes(s)||e({choose:[...r,s]}):e({choose:[s]})},removeChoose:s=>{let{choose:r}=t();if(r){let t=r.filter(e=>e!==s);e({choose:t.length>0?t:void 0})}},clearChoose:()=>{e({choose:void 0})},isChosen:e=>{let{choose:s}=t();return!!s&&s.includes(e)}}));var b=s(95139);function v(){let e=(0,n.c3)("nav"),t=(0,n.c3)("pages.files"),s=(0,n.c3)("files"),c=(0,n.c3)("actions"),x=(0,n.c3)("common"),[v,j]=(0,a.useState)("grid"),{handleFilesSelected:N,handleUploadComplete:y,handleUploadError:w}=function(){let{addFile:e,updateProgress:t,completeUpload:s,setError:r}=u(),l=(0,a.useCallback)(s=>{s.forEach(s=>{let r=e(s),a=0,l=setInterval(()=>{(a+=15*Math.random())>=100&&(a=100,clearInterval(l)),t(r,a)},200)})},[e,t]);return{handleFilesSelected:l,handleUploadComplete:(0,a.useCallback)(e=>{let t=u.getState().uploadingFiles.find(e=>"uploading"===e.status);t&&s(t.id,e)},[s]),handleUploadError:(0,a.useCallback)(e=>{let t=u.getState().uploadingFiles.find(e=>"uploading"===e.status);t&&r(t.id,e)},[r])}}(),{choose:D,setChoose:k,toggleChoose:C,clearChoose:F,isChosen:E}=f(),U=(0,n.Dh)(),T=u(),{data:S=[],loading:A,error:M}=(0,n.Rs)({table:"files",where:{},returning:["id","name","size","mimeType","createdAt","updatedAt","isUploaded","uploadedByUserId"],order_by:[{createdAt:"desc"}]}),B=e=>{if(0===e)return"0 Bytes";let t=Math.floor(Math.log(e)/Math.log(1024));return parseFloat((e/Math.pow(1024,t)).toFixed(2))+" "+["Bytes","KB","MB","GB"][t]},z=e=>e.startsWith("image/")?"\uD83D\uDDBC️":e.startsWith("video/")?"\uD83C\uDFA5":e.startsWith("audio/")?"\uD83C\uDFB5":e.includes("pdf")?"\uD83D\uDCC4":e.includes("text/")?"\uD83D\uDCDD":e.includes("application/")?"\uD83D\uDCE6":"\uD83D\uDCC1",P=(e,t)=>t.startsWith("image/")?"/api/files/".concat(e):null,W=e=>new Date(e).toLocaleDateString(),$=async e=>{if(confirm(s("confirm.deleteOne")))try{if((await fetch("/api/files/".concat(e),{method:"DELETE"})).ok)o.oR.success(s("toast.deleteSuccessOne"));else throw Error(s("toast.deleteFailed"))}catch(e){console.error("Delete error:",e),o.oR.error(s("toast.deleteFailed"))}},I=async()=>{if(D&&0!==D.length&&confirm(s("confirm.deleteMany",{count:D.length})))try{await U.delete({table:"deleteFiles",where:{id:{_in:D}}}),o.oR.success(s("toast.deleteSuccessMany",{count:D.length})),F()}catch(e){console.error("Delete selected files error:",e),o.oR.error(s("toast.deleteFailedMany"))}};return M&&!S.length?(0,r.jsx)(d.SidebarLayout,{sidebarData:l.A,breadcrumb:[{title:i.UU,link:"/"},{title:e("files"),link:"/hasyx/files"}],children:(0,r.jsx)("div",{className:"flex flex-1 flex-col gap-4 p-4",children:(0,r.jsx)("div",{className:"bg-destructive/10 border border-destructive/20 rounded-lg p-4",children:(0,r.jsx)("div",{className:"text-destructive",children:s("toast.errorLoading",{message:M.message})})})})}):(0,r.jsx)(d.SidebarLayout,{sidebarData:l.A,breadcrumb:[{title:i.UU,link:"/"},{title:e("files"),link:"/hasyx/files"}],children:(0,r.jsxs)("div",{className:"flex flex-1 flex-col gap-4 p-4",children:[(0,r.jsxs)("div",{className:"space-y-2",children:[(0,r.jsx)("h1",{className:"text-3xl font-bold",children:t("title")}),(0,r.jsx)("p",{className:"text-muted-foreground",children:t("description")})]}),(0,r.jsxs)(m,{onFilesSelected:N,onUploadComplete:y,onUploadError:w,multiple:!0,className:"mb-6 bg-card p-8 rounded-xl shadow-sm border-2 border-dashed border-border hover:border-primary transition-colors cursor-pointer",dragActiveClassName:"border-primary bg-primary/10",children:[(0,r.jsxs)("div",{className:"text-center space-y-4",children:[(0,r.jsx)("div",{className:"text-6xl",children:"\uD83D\uDCC1"}),(0,r.jsxs)("div",{className:"space-y-2",children:[(0,r.jsx)("h2",{className:"text-2xl font-semibold",children:s("example.dropHere")}),(0,r.jsx)("p",{className:"text-muted-foreground",children:s("example.orClick")})]}),(0,r.jsx)(h.$,{className:"bg-primary hover:bg-primary/90 text-primary-foreground px-6 py-3 rounded-lg font-medium transition-colors duration-200 flex items-center space-x-2 mx-auto",children:(0,r.jsx)("span",{children:s("example.uploadFiles")})})]}),(0,r.jsx)("div",{className:"mt-6",children:(0,r.jsx)(p,{onRemove:e=>T.removeFile(e),renderRemoveButton:e=>(0,r.jsx)("button",{onClick:t=>{t.stopPropagation(),T.removeFile(e)},className:"text-muted-foreground hover:text-destructive transition-colors p-1",title:s("removeFile"),type:"button",children:"✕"})})})]}),(0,r.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,r.jsx)("div",{className:"text-sm text-muted-foreground bg-muted px-4 py-2 rounded-lg",children:A?(0,r.jsx)("div",{className:"flex items-center space-x-2",children:(0,r.jsx)(g.n,{status:"connecting",label:x("loading")})}):s("items",{count:S.length})}),(0,r.jsxs)("div",{className:"flex items-center space-x-4",children:[D?(0,r.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,r.jsx)(h.$,{variant:"destructive",size:"sm",onClick:I,children:c("delete")}),(0,r.jsx)(h.$,{variant:"outline",size:"sm",onClick:()=>{k(S.map(e=>e.id))},children:x("yes")}),(0,r.jsx)("span",{className:"text-sm font-medium text-primary",children:s("selected",{count:D.length})}),(0,r.jsx)(h.$,{variant:"outline",size:"sm",onClick:F,children:c("cancel")})]}):(0,r.jsx)(h.$,{variant:"outline",size:"sm",onClick:()=>k([]),children:c("select")||"Choose"}),(0,r.jsxs)("div",{className:"flex items-center space-x-2 bg-muted rounded-lg p-1",children:[(0,r.jsxs)("button",{onClick:()=>j("grid"),className:"px-3 py-2 rounded-md text-sm font-medium transition-colors ".concat("grid"===v?"bg-background text-primary shadow-sm":"text-muted-foreground hover:text-foreground"),children:["\uD83D\uDDBC️ ",s("view.grid")]}),(0,r.jsxs)("button",{onClick:()=>j("list"),className:"px-3 py-2 rounded-md text-sm font-medium transition-colors ".concat("list"===v?"bg-background text-primary shadow-sm":"text-muted-foreground hover:text-foreground"),children:["\uD83D\uDCCB ",s("view.list")]}),(0,r.jsxs)("button",{onClick:()=>j("table"),className:"px-3 py-2 rounded-md text-sm font-medium transition-colors ".concat("table"===v?"bg-background text-primary shadow-sm":"text-muted-foreground hover:text-foreground"),children:["\uD83D\uDCCA ",s("view.table")]})]})]})]}),A&&(0,r.jsx)("div",{className:"flex items-center justify-center py-8",children:(0,r.jsx)(g.n,{status:"connecting",label:s("loadingFiles")})}),!A&&"grid"===v&&(0,r.jsx)("div",{className:"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 xl:grid-cols-5 gap-6",children:S.map(e=>(0,r.jsxs)("div",{className:"bg-card rounded-xl shadow-sm border border-border p-6 hover:shadow-md transition-shadow duration-200 relative",children:[D&&(0,r.jsx)("div",{className:"absolute top-2 left-2 z-10",children:(0,r.jsx)(b.S,{checked:E(e.id),onCheckedChange:()=>C(e.id)})}),(0,r.jsxs)("div",{className:"text-center",children:[e.mimeType.startsWith("image/")?(0,r.jsxs)("div",{className:"mb-4",children:[(0,r.jsx)("img",{src:P(e.id,e.mimeType),alt:e.name,className:"w-full h-32 object-cover rounded-lg border border-border",onError:e=>{let t=e.target;t.style.display="none",t.nextElementSibling.classList.remove("hidden")}}),(0,r.jsx)("div",{className:"text-5xl hidden",children:z(e.mimeType)})]}):(0,r.jsx)("div",{className:"text-5xl mb-4",children:z(e.mimeType)}),(0,r.jsx)("div",{className:"text-sm font-medium text-foreground truncate mb-2",title:e.name,children:e.name}),(0,r.jsx)("div",{className:"text-xs text-muted-foreground mb-3",children:B(e.size)}),(0,r.jsx)("div",{className:"text-xs text-muted-foreground/70 mb-4",children:W(e.createdAt)}),(0,r.jsx)("div",{className:"mb-4",children:(0,r.jsx)("span",{className:"inline-flex px-2 py-1 text-xs font-semibold rounded-full ".concat(e.isUploaded?"bg-green-100 text-green-800":"bg-yellow-100 text-yellow-800"),children:e.isUploaded?s("status.uploaded"):s("status.processing")})}),(0,r.jsxs)("div",{className:"flex justify-center space-x-2",children:[(0,r.jsxs)("a",{href:"/api/files/".concat(e.id),download:e.name,className:"text-primary hover:text-primary/80 text-sm font-medium",children:["\uD83D\uDCE5 ",c("download")]}),(0,r.jsxs)("button",{onClick:()=>$(e.id),className:"text-destructive hover:text-destructive/80 text-sm font-medium",children:["\uD83D\uDDD1️ ",c("delete")]})]})]})]},e.id))}),!A&&"list"===v&&(0,r.jsx)("div",{className:"bg-card rounded-xl shadow-sm border border-border overflow-hidden",children:S.map(e=>(0,r.jsx)("div",{className:"p-6 border-b border-border/50 last:border-b-0 hover:bg-muted/50 transition-colors",children:(0,r.jsxs)("div",{className:"flex items-center justify-between",children:[(0,r.jsxs)("div",{className:"flex items-center space-x-4",children:[D&&(0,r.jsx)(b.S,{checked:E(e.id),onCheckedChange:()=>C(e.id)}),e.mimeType.startsWith("image/")?(0,r.jsxs)("div",{className:"w-12 h-12 flex-shrink-0",children:[(0,r.jsx)("img",{src:P(e.id,e.mimeType),alt:e.name,className:"w-full h-full object-cover rounded border border-border",onError:e=>{let t=e.target;t.style.display="none",t.nextElementSibling.classList.remove("hidden")}}),(0,r.jsx)("span",{className:"text-2xl hidden",children:z(e.mimeType)})]}):(0,r.jsx)("span",{className:"text-3xl",children:z(e.mimeType)}),(0,r.jsxs)("div",{children:[(0,r.jsx)("div",{className:"font-medium text-foreground",children:e.name}),(0,r.jsxs)("div",{className:"text-sm text-muted-foreground",children:[B(e.size)," • ",W(e.createdAt),!e.isUploaded&&" • ⏳ Processing"]})]})]}),(0,r.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,r.jsx)("span",{className:"inline-flex px-2 py-1 text-xs font-semibold rounded-full ".concat(e.isUploaded?"bg-green-100 text-green-800":"bg-yellow-100 text-yellow-800"),children:e.isUploaded?s("status.uploaded"):s("status.processing")}),(0,r.jsxs)("a",{href:"/api/files/".concat(e.id),download:e.name,className:"text-primary hover:text-primary/80 text-sm font-medium",children:["\uD83D\uDCE5 ",c("download")]}),(0,r.jsxs)("button",{onClick:()=>$(e.id),className:"text-destructive hover:text-destructive/80 text-sm font-medium",children:["\uD83D\uDDD1️ ",c("delete")]})]})]})},e.id))}),!A&&"table"===v&&(0,r.jsx)("div",{className:"bg-card rounded-xl shadow-sm border border-border overflow-hidden",children:(0,r.jsxs)("table",{className:"w-full",children:[(0,r.jsx)("thead",{className:"bg-muted/50",children:(0,r.jsxs)("tr",{children:[D&&(0,r.jsx)("th",{className:"px-6 py-4 text-left text-xs font-medium text-muted-foreground uppercase tracking-wider",children:s("table.select")}),(0,r.jsx)("th",{className:"px-6 py-4 text-left text-xs font-medium text-muted-foreground uppercase tracking-wider",children:s("table.file")}),(0,r.jsx)("th",{className:"px-6 py-4 text-left text-xs font-medium text-muted-foreground uppercase tracking-wider",children:s("table.size")}),(0,r.jsx)("th",{className:"px-6 py-4 text-left text-xs font-medium text-muted-foreground uppercase tracking-wider",children:s("table.type")}),(0,r.jsx)("th",{className:"px-6 py-4 text-left text-xs font-medium text-muted-foreground uppercase tracking-wider",children:s("table.created")}),(0,r.jsx)("th",{className:"px-6 py-4 text-left text-xs font-medium text-muted-foreground uppercase tracking-wider",children:s("table.status")}),(0,r.jsx)("th",{className:"px-6 py-4 text-left text-xs font-medium text-muted-foreground uppercase tracking-wider",children:s("table.actions")})]})}),(0,r.jsx)("tbody",{className:"bg-card divide-y divide-border/50",children:S.map(e=>(0,r.jsxs)("tr",{className:"hover:bg-muted/50 transition-colors",children:[D&&(0,r.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,r.jsx)(b.S,{checked:E(e.id),onCheckedChange:()=>C(e.id)})}),(0,r.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,r.jsxs)("div",{className:"flex items-center",children:[(0,r.jsx)("span",{className:"text-2xl mr-3",children:z(e.mimeType)}),(0,r.jsx)("div",{className:"text-sm font-medium text-foreground",children:e.name})]})}),(0,r.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-muted-foreground",children:B(e.size)}),(0,r.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-muted-foreground",children:e.mimeType}),(0,r.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-muted-foreground",children:W(e.createdAt)}),(0,r.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,r.jsx)("span",{className:"inline-flex px-2 py-1 text-xs font-semibold rounded-full ".concat(e.isUploaded?"bg-green-100 text-green-800":"bg-yellow-100 text-yellow-800"),children:e.isUploaded?"Uploaded":"Processing"})}),(0,r.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium",children:(0,r.jsxs)("div",{className:"flex space-x-3",children:[(0,r.jsx)("a",{href:"/api/files/".concat(e.id),download:e.name,className:"text-primary hover:text-primary/80",children:"\uD83D\uDCE5 Download"}),(0,r.jsx)("button",{onClick:()=>$(e.id),className:"text-destructive hover:text-destructive/80",children:"\uD83D\uDDD1️ Delete"})]})})]},e.id))})]})})]})})}},87251:(e,t,s)=>{"use strict";s.d(t,{n:()=>o});var r=s(95155),a=s(97168),l=s(88893),i=s(51154),d=s(5196),n=s(54416);function o(e){let{status:t="connecting",label:s,error:o}=e,c=(0,l.c3)("common"),m=s||c("loading"),x=s||c("yes"),u=s||c("error"),p=s||"Idle";return(0,r.jsxs)(r.Fragment,{children:["connecting"===t&&(0,r.jsxs)(a.$,{variant:"ghost",className:"p-0",children:[(0,r.jsx)(i.A,{className:"animate-spin mr-1"})," ",m]}),"connected"===t&&(0,r.jsxs)(a.$,{variant:"ghost",className:"p-0",children:[(0,r.jsx)(d.A,{className:"mr-1"})," ",x]}),"error"===t&&(0,r.jsxs)(a.$,{variant:"ghost",className:"p-0",children:[(0,r.jsx)(n.A,{className:"mr-1"})," ",u]}),"idle"===t&&(0,r.jsxs)(a.$,{variant:"ghost",className:"p-0",children:[(0,r.jsx)(n.A,{className:"mr-1"})," ",p]})]})}}},e=>{var t=t=>e(e.s=t);e.O(0,[2115,5741,8893,5366,4499,9918,8441,1684,7358],()=>t(33487)),_N_E=e.O()}]);