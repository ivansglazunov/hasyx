"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[2127],{22127:(e,s,n)=>{n.d(s,{sendTelegramNotification:()=>o});var t=n(13853),a=n(87358);let r=(0,t.A)("notify:telegram");async function o(e,s,n){r("Sending notification via Telegram bot");let t=a.env.TELEGRAM_BOT_TOKEN;if(!t)return r("TELEGRAM_BOT_TOKEN is not set in environment variables."),{success:!1,message:"Telegram Bot Token not configured."};if(!e.device_token)return r("Telegram chat_id (device_token) is missing in permission."),{success:!1,message:"Telegram chat_id is missing."};let o=e.device_token,i="*".concat(s.title,"*\n\n").concat(s.body);if(s.data&&Object.keys(s.data).length>0)for(let[e,n]of(i+="\n\n*Details:*",Object.entries(s.data)))i+="\n- ".concat(e,": ").concat(n);n.config&&Object.keys(n.config).length;try{let e=await fetch("https://api.telegram.org/bot".concat(t,"/sendMessage"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({chat_id:o,text:i,parse_mode:"Markdown"})}),s=await e.json();if(!e.ok||!s.ok)return r("Failed to send Telegram message:",s),{success:!1,message:"Telegram API error: ".concat(s.description||"Unknown error"," (Code: ").concat(s.error_code||e.status,")")};return r("Telegram message sent successfully:",s.result),{success:!0}}catch(e){return r("Error sending Telegram message:",e),{success:!1,message:e instanceof Error?e.message:"Unknown error sending Telegram message"}}}}}]);