# Программный интерфейс (API)

Подключение через программный интерфейс (API) позволяет использовать всю доступную

функциональность платёжного шлюза.

## Требования к ресурсу продавца

Ресурс продавца должен соответствовать следующим требования:

```
для взаимодействия с платёжным шлюзом, необходимо иметь открытый исходящий доступ к
адресу 3dsec.sberbank.ru , порт 443;
сервер продавца должен поддерживать протокол TLS 1.2.
```
## Доступные интерфейсы

Существует возможность настроить взаимодействие с платёжным шлюзом, используя следующие

интерфейсы:

```
интерфейс REST;
интерфейс WSDL (SOAP).
```
## Интерфейс REST

### Введение

REST - простой способ передачи данных по сети. Данные передаются с помощью HTTP-запросов

(GET или POST), содержащих набор параметров. Результат обработки запроса возвращается в виде

объекта JSON (см. пример результата ниже).

```
{"errorCode":"12","errorMessage":"Empty amount"}
```

### Аутентификация продавца

Для аутентификации продавца при обращении к платёжному шлюзу можно использовать один из

следующих способов.

```
С помощью логина и пароля служебной учётной записи (учётная запись с суффиксом -api ),
полученной при регистрации. Значения имени и пароля передаются в параметрах userName
и password соответственно (см. таблицу ниже).
```
```
Название Тип Обязательно Описание
```
```
userName Строка См. описание
```
```
Логин служебной учётной записи продавца. При
передаче логина и пароля для аутентификации в
платёжном шлюзе параметр token передавать не
нужно.
```
```
password Строка См. описание
```
```
Пароль служебной учётной записи продавца. При
передаче логина и пароля для аутентификации в
платёжном шлюзе параметр token передавать не
нужно.
```
```
С помощью специального токена - его значение можно получить у технической поддержки.
Значение токена передаётся в параметре token (см. таблицу ниже).
```
```
token Строка
```
```
См.
описание
```
```
Значение, которое используется для аутентификации
продавца при отправке запросов в платёжный шлюз. При
передаче этого параметра параметры userName и pаssword
передавать не нужно.
```
```
Пользуясь протоколом REST, следует отправлять запросы с типом application/x-
www-form-urlencoded, а не multipart/form-data.
```
### Запросы

Запросы должны соответствовать следующим требованиям:

```
все текстовые поля должны иметь кодировку Юникод (UTF-8);
специальные символы в запросе REST должны быть экранированы в соответствии с URL-
кодом, например, пароль qwe?rt%y должен передаваться в виде qwe%0Frt%25y.
```
URL-адреса для доступа к запросам REST представлены в таблице ниже.


**Название запроса URL**

Регистрация заказа https://3dsec.sberbank.ru/payment/rest/register.do

Регистрация заказа с
предавторизацией https://3dsec.sberbank.ru/payment/rest/registerPreAuth.do

Запрос завершения оплаты
заказа https://3dsec.sberbank.ru/payment/rest/deposit.do

Запрос отмены оплаты заказа https://3dsec.sberbank.ru/payment/rest/reverse.do

Запрос возврата средств
оплаты заказа https://3dsec.sberbank.ru/payment/rest/refund.do

Получение статуса заказа https://3dsec.sberbank.ru/payment/rest/getOrderStatusExtended.do

Запрос оплаты через Apple
Pay https://3dsec.sberbank.ru/payment/applepay/payment.do

Запрос оплаты через Apple
Pay Direct https://3dsec.sberbank.ru/payment/applepay/paymentDirect.do

Запрос оплаты через
Samsung Pay https://3dsec.sberbank.ru/payment/samsung/payment.do

Запрос оплаты через Google
Pay https://3dsec.sberbank.ru/payment/google/payment.do

Запрос оплаты через Google
Pay Direct https://3dsec.sberbank.ru/payment/google/paymentDirect.do

Запрос сведений о кассовом
чеке
(Для продавцов,
подключённых к оператору
фискальных данных.)

```
https://3dsec.sberbank.ru/payment/rest/getReceiptStatus.do
```
Запрос деактивации связки https://3dsec.sberbank.ru/payment/rest/unBindCard.do

Запрос активации связки https://3dsec.sberbank.ru/payment/rest/bindCard.do

Запрос списка всех связок
клиента https://3dsec.sberbank.ru/payment/rest/getBindings.do

Запрос списка связок
определённой банковской
карты

```
https://3dsec.sberbank.ru/payment/rest/getBindingsByCardOrId.do
```
Запрос изменения срока
действия связки https://3dsec.sberbank.ru/payment/rest/extendBinding.do


### Особенности тестирования запросов REST в браузере

Если тестирование REST-запросов происходит в том же браузере, в котором выполнен вход в

личный кабинет, то выполнение любого REST-запроса приведёт к тому, что в личном кабинете

будет отображаться ошибка. Чтобы восстановить работу личного кабинета:

```
выполните выход из личного кабинета и снова зайдите в него;
если предыдущий способ не работает, удалите cookie-файлы и снова войдите в личный
кабинет.
```
```
Подобной ситуации можно избежать одним из следующих способов:
```
```
используйте для REST-запросов режим «инкогнито», а работу в личном
кабинете проводите в окне браузера в обычном режиме;
для тестирования REST-запросов и работы в личном кабинете используйте
разные браузеры.
```
**Возможные сценарии взаимодействия**

В соответствии с российским законодательством продавцы должны отправлять электронные

версии чеков оператору фискальных данных через интернет. Существует возможность упростить

эту процедуру: вы будете отправлять необходимые данные в запросах, а регистрацию чеков на

контрольно-кассовой технике будет осуществлять «Сбербанк».

```
Сценарии взаимодействия при обычной оплате (регистрация чеков реализуется продавцом
самостоятельно)
Сценарии взаимодействия при регистрации чеков на контрольно-кассовой технике
(регистрация чеков производится «Сбербанком»)
Стандартный API
Apple Pay
Google Pay
Samsung Pay
Оплата с предоставлением возможности интернет-кредитования (сценарии взаимодействия
при оплате с предоставлением покупателю возможности получить кредит)
Сценарии взаимодействия при оплате по связкам
```
**Обычная оплата**


**Оплата с указанием карточных данных на платёжной странице**

```
Одностадийная оплата Двухстадийная оплата
```
```
1 Плательщик выбирает товар или услугу на ресурсе продавца и выбирает способ оплатыбанковской картой.
```
#### 2

```
Продавец отправляет в платёжный
шлюз запрос на регистрацию
заказа:
```
-
register.do.
В том числе в запросе передаются
следующие параметры:
-
returnUrl - URL-адрес, на который
будет перенаправлен плательщик в
случае успешного платежа;
-
failUrl - URL-адрес, на который
будет перенаправлен плательщик в
случае неуспешного платежа.

```
Продавец отправляет в платёжный шлюз запрос на
регистрацию заказа с предавторизацией:
```
-
registerPreAuth.do.
В том числе в запросе передаются следующие
параметры:
-
amount - сумма списания;
-
orderNumber - номер заказа в системе магазина;
-
returnUrl - URL-адрес, на который будет
перенаправлен плательщик в случае успешного
платежа;
-
failUrl - URL-адрес, на который будет
перенаправлен плательщик в случае неуспешного
платежа.

#### 3

```
Платёжный шлюз в ответе в числе прочего возвращает параметры:
```
-
orderId - уникальный идентификатор заказа в платёжной системе;
-
formUrl - URL-адрес формы ввода данных банковской карты (платёжная форма).

```
4 Продавец перенаправляет плательщику URL-адрес, указанный в параметре formUrl
ответа.
```
```
5 В браузере плательщика отображается форма ввода данных банковской карты.
Плательщик заполняет форму и отправляет данные на сервер платёжного шлюза.
```
#### 6

```
Дальнейшие действия зависят от того, поддерживает ли карта покупателя 3-D Secure:
```
-
поддержка 3-D Secure отсутствует - переход к следующему шагу процедуры;
-
есть поддержка 3-D Secure - платёжный шлюз перенаправляет плательщика на форму
аутентификации (чаще всего это проверка с помощью SMS-сообщения), расположенную на
сервере контроля доступа, принадлежащего банку-эмитенту - в случае успешной
аутентификации выполняется следующий шаг сценария.

```
7 Платёжный шлюз списывает деньгисо счёта плательщика. Платёжный шлюз производит холдирование(удержание) средств на счёте плательщика.
```
```
8 После проведения оплаты платёжный шлюз перенаправляет клиента навозврата (указанный магазином в запросе на регистрацию). URL-адрес
```
```
9 Браузер клиента запрашивает страницу с результатами оплаты у магазина.
```

```
Одностадийная оплата Двухстадийная оплата
```
#### 10

```
Продавец запрашивает у платёжного шлюза статус оплаты заказа, используя уникальный
идентификатор, полученный при регистрации заказа в параметре orderId:
```
-
getOrderStatusExtended.do.

```
11 Платёжный шлюз возвращает статус оплаты и продавец передаёт в браузер клиента
страницу с результатами оплаты.
```
```
12 Не актуально
```
```
Для списания средств со счёта клиента продавец
должен направить в платёжный шлюз запрос
завершения оплаты:
```
-
deposit.do.

```
13 Не актуально
```
```
Платёжный шлюз возвращает результат обработки
запроса. Статус заказа не возвращается. Для
получения статуса заказа необходимо отправить в
шлюз запрос состояния заказа:
```
-
getOrderStatusExtended.do.

```
Для получения информации о состоянии заказа вместо отправки запроса
getOrderStatusExtended вы можете получать уведомления обратного вызова. Эти
уведомления будут отправляться вам автоматически после изменения статуса
заказа.
```
**Отмена платежа**

Отмена оплаты заказа доступна при наличии соответствующих прав по согласованию со

«Сбербанком».

```
При одностадийных платежах отмена платежа возможна для заказов в
состоянии Завершён/Deposited , но только до закрытия дня, т. е. до 24:00 (по
московскому времени) того дня, когда была произведена оплата.
При двухстадийных платежах отмену платежа можно выполнить для заказа в
состоянии Подтверждён/Approved.
```
В таблице ниже представлена схема взаимодействий продавца и платёжного шлюза при отмене

оплаты.


#### 1

```
Продавец делает запрос на отмену платежа:
```
-
reverse.do.

#### 2

```
После получения успешного ответа платёжного шлюза продавец делает запрос статуса
заказа:
```
-
getOrderStatusExtended.do;

```
Для получения информации о состоянии заказа вместо отправки запроса
getOrderStatusExtended вы можете получать уведомления обратного вызова. Эти
уведомления будут отправляться вам автоматически после изменения статуса
заказа.
```
**Возврат средств плательщику**

Платёжный шлюз позволяет осуществлять полный или частичный возврат средств по оплаченным

заказам.

```
Возврат средств возможен для платежей в состоянии Завершён/Deposited.
```
В таблице ниже представлена схема взаимодействий продавца и платёжного шлюза при возврате

средств покупателю.

#### 1

```
Продавец делает запрос на возврат средств покупателю:
```
-
refund.do.

#### 2

```
После получения успешного ответа платёжного шлюза продавец делает запрос статуса
заказа:
```
-
getOrderStatusExtended.do.

```
Для получения информации о состоянии заказа вместо отправки запроса
getOrderStatusExtended вы можете получать уведомления обратного вызова. Эти
уведомления будут отправляться вам автоматически после изменения статуса
заказа.
```

**Оплата с регистрацией чеков на контрольно-кассовой технике**

**Стандартный API**

**Оплата с передачей корзины и данных для регистрации чека**

```
Одностадийная оплата Двухстадийная оплата
```
```
1 Плательщик выбирает товар или услугу на ресурсе продавца и выбирает способ оплатыбанковской картой.
```
#### 2

```
Продавец отправляет в платёжный
шлюз запрос на регистрацию заказа:
```
-
register.do.
В том числе в запросе передаются
следующие параметры:
-
returnUrl - URL-адрес, на который
будет перенаправлен плательщик в
случае успешного платежа;
-
failUrl - URL-адрес, на который
будет перенаправлен плательщик в
случае неуспешного платежа.
-
orderBundle - блок, содержащий
корзину товаров и данные для
регистрации чека;
-
taxSystem - идентификатор
системы налогообложения.

```
Продавец отправляет в платёжный шлюз запрос на
регистрацию заказа с предавторизацией:
```
-
registerPreAuth.do.
В том числе в запросе передаются следующие
параметры:
-
amount - сумма списания;
-
orderNumber - номер заказа в системе магазина;
-
returnUrl - URL-адрес, на который будет
перенаправлен плательщик в случае успешного
платежа;
-
failUrl - URL-адрес, на который будет
перенаправлен плательщик в случае неуспешного
платежа.
-
orderBundle - блок, содержащий корзину товаров
и данные для регистрации чека;
-
taxSystem - идентификатор системы
налогообложения.

#### 3

```
Платёжный шлюз в ответе в числе прочего возвращает параметры:
```
-
orderId - уникальный идентификатор заказа в платёжной системе;
-
formUrl - URL-адрес формы ввода данных банковской карты (платёжная форма).

```
4 Продавец перенаправляет плательщикуответа. URL-адрес, указанный в параметре formUrl
```
```
5 В браузере плательщика отображается форма ввода данных банковской карты.Плательщик заполняет форму и отправляет данные на сервер платёжного шлюза.
```

```
Одностадийная оплата Двухстадийная оплата
```
#### 6

```
Дальнейшие действия зависят от того, поддерживает ли карта покупателя 3-D Secure:
```
-
поддержка 3-D Secure отсутствует - переход к следующему шагу процедуры;
-
есть поддержка 3-D Secure - платёжный шлюз перенаправляет плательщика на форму
аутентификации (чаще всего это проверка с помощью SMS-сообщения), расположенную на
сервере контроля доступа, принадлежащего банку-эмитенту - в случае успешной
аутентификации выполняется следующий шаг сценария.

**7** Платёжный шлюз списывает деньгисо счёта плательщика. Платёжный шлюз производит холдирование(удержание) средств на счёте плательщика.

#### 8

```
После проведения оплаты платёжный шлюз перенаправляет клиента на URL-адрес
возврата.
```
**9** Браузер клиента запрашивает страницу с результатами оплаты у магазина.

#### 10

```
Продавец запрашивает у платёжного шлюза статус оплаты заказа, используя уникальный
идентификатор, полученный при регистрации заказа в параметре orderId:
```
-
getOrderStatusExtended.do.

**11** Платёжный шлюз возвращает статус оплаты и продавец передаёт в браузер клиента
страницу с результатами оплаты.

**12 Не актуально**

```
Для списания средств со счёта клиента продавец
должен направить в платёжный шлюз запрос
завершения оплаты:
```
-
завершение с оплатой полной суммой:
⚬
deposit.do;
-
завершение с оплатой части суммы:
⚬
deposit.do.

**13 Не актуально**

```
Платёжный шлюз возвращает результат обработки
запроса. Статус заказа не возвращается. Для
получения статуса заказа необходимо отправить в
шлюз запрос состояния заказа:
```
-
getOrderStatusExtended.do.

```
Для получения информации о состоянии заказа вместо отправки запроса
getOrderStatusExtended вы можете получать уведомления обратного вызова. Эти
уведомления будут отправляться вам автоматически после изменения статуса
заказа.
```

```
Чтобы получить сведения о кассовом чеке (например, чтобы передать эти данные
покупателю) используйте запрос getReceiptStatus.do. В настоящее время этот запрос
можно выполнить только через интерфейс REST.
```
**Отмена платежа**

Отмена оплаты заказа доступна при наличии соответствующих прав по согласованию со

«Сбербанком».

```
При одностадийных платежах отмена платежа возможна для заказов в
состоянии Завершён/Deposited , но только до закрытия дня, т. е. до 24:00 (по
московскому времени) того дня, когда была произведена оплата.
При двухстадийных платежах отмену платежа можно выполнить для заказа в
состоянии Подтверждён/Approved.
```
В таблице ниже представлена схема взаимодействий продавца и платёжного шлюза при отмене

оплаты.

#### 1

```
Продавец делает запрос на отмену платежа:
```
-
reverse.do.

#### 2

```
После получения успешного ответа платёжного шлюза продавец делает запрос статуса
заказа:
```
-
getOrderStatusExtended.do;

```
Для получения информации о состоянии заказа вместо отправки запроса
getOrderStatusExtended вы можете получать уведомления обратного вызова. Эти
уведомления будут отправляться вам автоматически после изменения статуса
заказа.
```
**Возврат средств плательщику**

Платёжный шлюз позволяет осуществлять полный или частичный возврат средств по оплаченным

заказам.


```
Возврат средств возможен для платежей в состоянии Завершён/Deposited.
```
В таблице ниже представлена схема взаимодействий продавца и платёжного шлюза при возврате

средств покупателю.

#### 1

```
Продавец делает запрос на возврат средств покупателю:
```
-
возврат полной суммы:
⚬
refund.do;
-
частичный возврат:
⚬
refund.do.

#### 2

```
После получения успешного ответа платёжного шлюза продавец делает запрос статуса
заказа:
```
-
getOrderStatusExtended.do.

```
Для получения информации о состоянии заказа вместо отправки запроса
getOrderStatusExtended вы можете получать уведомления обратного вызова. Эти
уведомления будут отправляться вам автоматически после изменения статуса
заказа.
```
**Apple Pay**

При оплате с использованием Apple Pay взаимодействие происходит по следующей схеме.

```
Одностадийный платёж Двухстадийный платёж
```
```
1 Пользователь в мобильном приложении выбирает вариант оплаты с помощью Apple Pay.
```
```
2 Сведения о платеже направляются на обработку в систему Apple Pay.
```
#### 3

```
Для обработки данных о платеже в системе Apple Pay создаётся объект PKPaymentToken
Object, который содержит свойство paymentData (здесь и далее см. документацию Apple
Pay).
```
```
4 Apply Pay направляет продавцу (мобильному приложению) ответ.
```
```
5 Продавец извлекает из полученного объекта paymentData и кодирует его содержимое в Base64.PKPaymentToken Object свойство
```

```
Одностадийный платёж Двухстадийный платёж
```
#### 6

```
Продавец создаёт запрос на оплату,
содержащий в том числе свойство
paymentData, полученное из ответа
системы Apple Pay и закодированное
в Base64, и отправляет его на
обработку в платёжный шлюз. Для
оплаты через Apple Pay
используется следующий запрос:
```
-
payment.do (интерфейс REST).
При этом параметр preAuth либо не
передаётся, либо имеет значение
false (ложь).

```
Продавец создаёт запрос на оплату, содержащий в
том числе свойство paymentData, полученное из
ответа системы Apple Pay и закодированное в
Base64, и отправляет его на обработку в
платёжный шлюз. Для оплаты через Apple Pay
используется следующий запрос:
```
-
payment.do (интерфейс REST).
При этом в запросе передаётся параметр preAuth,
который имеет значение true (истина).

#### 7

```
Платёжный шлюз обрабатывает запрос и возвращает ответ с результатом:
```
-
интерфейс REST.

```
8 Мобильное приложение отображает пользователю результат оплаты.
```
#### 9

```
Продавец запрашивает у платёжного шлюза статус оплаты заказа, используя уникальный
идентификатор, полученный при регистрации заказа в параметре orderId:
```
-
getOrderStatusExtended.do (интерфейс REST).

```
10 Не актуально
```
```
Для списания средств со счёта клиента продавец
должен направить в платёжный шлюз запрос
завершения оплаты:
```
-
deposit.do (интерфейс REST).

```
11 Не актуально
```
```
Платёжный шлюз возвращает результат обработки
запроса. Статус заказа не возвращается. Для
получения статуса заказа необходимо отправить в
шлюз запрос состояния заказа:
```
-
getOrderStatusExtended.do (интерфейс REST).

**Google Pay**

```
Сведения для разработчиков представлены на сайте Google.
Приложение должно быть оформлено в соответствии с руководством по
использованию бренда.
```
При отправке запроса в Google Pay используйте следующие параметры:


```
gateway: sberbank;
gatewayMerchantId: <наименование вашей организации в системе платёжного шлюза>.
```
При оплате с использованием Google Pay через мобильное приложение взаимодействие происходит

по следующей схеме.

```
Одностадийный платёж Двухстадийный платёж
```
```
1 Пользователь выбирает способ оплаты Google Pay.
```
```
2 Приложение запрашивает Google Pay маскированные данные платёжной карты.
```
```
3 Google Pay возвращает в приложение маскированные данные платёжной карты.
```
```
4 Приложение отображает клиенту маскированные данные карты, добавленной вPay. Google
```
```
5 Пользователь подтверждает оплату.
```
```
6 Приложение запрашивает Google Pay зашифрованные данные платёжной карты.
```
#### 7

```
Google шифрует данные, используя открытый ключ - соответствующий ему закрытый ключ
расположен в платёжном шлюзе.
```
```
8 Google Pay возвращает в приложение зашифрованные данные о платеже.
```
#### 9

```
Приложение отправляет в
платёжный шлюз запрос на
оплату, указывая полученный от
Google Pay токен:
```
-
интерфейс REST (payment.do).
При этом параметр preAuth либо
не передаётся, либо имеет
значение false (ложь).

```
Приложение отправляет в платёжный шлюз запрос
на оплату, указывая полученный от Google Pay
токен:
```
-
интерфейс REST (payment.do).
При этом в запросе передаётся параметр preAuth,
который имеет значение true (истина).

```
10 Платёжный шлюз расшифровывает полученный токен и производит оплату.
```
```
11 Платёжный шлюз возвращает результат оплаты в приложение.
```
```
12 Приложение отображает результат покупки плательщику.
```
#### 13

```
Продавец запрашивает у платёжного шлюза статус оплаты заказа, используя уникальный
идентификатор, полученный при регистрации заказа в параметре orderId:
```
-
интерфейс REST (getOrderStatusExtended.do).


```
Одностадийный платёж Двухстадийный платёж
```
```
14 Не актуально
```
```
Для списания средств со счёта клиента продавец
должен направить в платёжный шлюз запрос
завершения оплаты:
```
-
интерфейс REST (deposit.do).

```
15 Не актуально
```
```
Платёжный шлюз возвращает результат обработки
запроса. Статус заказа не возвращается. Для
получения статуса заказа необходимо отправить в
шлюз запрос состояния заказа:
```
-
интерфейс REST (getOrderStatusExtended.do).

**Samsung Pay**

При оплате с использованием Samsung Pay взаимодействие происходит по следующей схеме.

```
Одностадийный платёж Двухстадийный платёж
```
```
1 Пользователь выбирает способ оплаты Samsung Pay.
```
```
2 Приложение отправляет сведения о платеже в Samsung.
```
#### 3

```
Samsung отправляет в приложение ответ содержащий, среди прочего, парамер 3ds.data с
зашифрованными данными о платеже.
```
#### 4

```
Продавец отправляет в
платёжный шлюз запрос на
оплату:
```
-
интерфейс REST (payment.do).
При этом:
-
параметр paymentToken
включает содержимое 3ds.data,
полученное от Samsung;
-
параметр preAuth либо не
передаётся, либо имеет значение
false (ложь).

```
Продавец отправляет в платёжный шлюз запрос на
оплату:
```
-
интерфейс REST (payment.do).
При этом:
-
параметр paymentToken включает содержимое
3ds.data, полученное от Samsung;
-
в запросе передаётся параметр preAuth, который
имеет значение true (истина).

```
5 Платёжный шлюз расшифровывает полученный токен и производит оплату.
```
```
6 Платёжный шлюз возвращает в приложение результат оплаты, который отображается наэкране мобильного устройства.
```
#### 7

```
Продавец запрашивает у платёжного шлюза статус оплаты заказа, используя уникальный
идентификатор, полученный при регистрации заказа в параметре orderId:
```
-
интерфейс REST (getOrderStatusExtended.do).


```
Одностадийный платёж Двухстадийный платёж
```
```
8 Не актуально
```
```
Для списания средств со счёта клиента продавец
должен направить в платёжный шлюз запрос
завершения оплаты:
```
-
интерфейс REST (deposit.do).

```
9 Не актуально
```
```
Платёжный шлюз возвращает результат обработки
запроса. Статус заказа не возвращается. Для
получения статуса заказа необходимо отправить в
шлюз запрос состояния заказа:
```
-
интерфейс REST (getOrderStatusExtended.do).

**Оплата с предоставлением возможности интернет-кредитования**

**Схема взаимодействий при использовании интернет-кредитования**

```
1 Клиент сформировал заказ в на сайте продавца и выбрал функцию «Оплата в кредит».
```
```
2 Система продавца регистрирует заказ в платёжном шлюзе: * интерфейс REST (register.do).
```
#### 3

```
Платёжный шлюз передаёт продавцу результат регистрации заказа, включая уникальный
идентификатор заказа и URL страницы выбора срока кредитования, на который надо
перенаправить браузер Клиента.
```
```
4 Продавец перенаправляет браузер клиента URL, полученный на предыдущем шаге.
```
```
5 Браузер клиента переходит по указанному URL.
```
```
6 Клиент получает страницу с описанием услуги кредитования.
```
```
7 Клиент нажимает кнопку Подать заявку.
```
```
8 Платёжный шлюз регистрирует заявку.
```
```
9 Платёжный шлюз перенаправляет браузер клиента URL Сбербанк Онлайн.
```
```
10 Браузер клиента переходит на страницу аутентификации Сбербанк Онлайн.
```
#### 11

```
В личном кабинете Сбербанк Онлайн клиент выбирает срок кредитования и проходит
процедура выдачи кредита.
```
```
12 Сбербанк Онлайн обменивается данными с платёжным шлюзом.
```
```
13 Сбербанк Онлайн производит оплату.
```
```
14 Сбербанк Онлайн информирует РБС об изменении статуса заказа на «оплачен».
```

```
15 После проведения оплаты Сбербанк Онлайн перенаправляет клиента на страницупродавца.
```
```
Для получения информации о состоянии заказа вместо отправки запроса
getOrderStatusExtended вы можете получать уведомления обратного вызова. Эти
уведомления будут отправляться вам автоматически после изменения статуса
заказа.
```
**Отмена платежа**

Отмена оплаты заказа доступна при наличии соответствующих прав по согласованию со

«Сбербанком».

```
При одностадийных платежах отмена платежа возможна для заказов в
состоянии Завершён/Deposited , но только до закрытия дня, т. е. до 24:00 (по
московскому времени) того дня, когда была произведена оплата.
При двухстадийных платежах отмену платежа можно выполнить для заказа в
состоянии Подтверждён/Approved.
```
В таблице ниже представлена схема взаимодействий продавца и платёжного шлюза при отмене

оплаты.

#### 1

```
Продавец делает запрос на отмену платежа:
```
-
reverse.do.

#### 2

```
После получения успешного ответа платёжного шлюза продавец делает запрос статуса
заказа:
```
-
getOrderStatusExtended.do;

```
Для получения информации о состоянии заказа вместо отправки запроса
getOrderStatusExtended вы можете получать уведомления обратного вызова. Эти
уведомления будут отправляться вам автоматически после изменения статуса
заказа.
```

**Возврат средств плательщику**

Платёжный шлюз позволяет осуществлять полный или частичный возврат средств по оплаченным

заказам.

```
Возврат средств возможен для платежей в состоянии Завершён/Deposited.
```
В таблице ниже представлена схема взаимодействий продавца и платёжного шлюза при возврате

средств покупателю.

#### 1

```
Продавец делает запрос на возврат средств покупателю:
```
-
возврат полной суммы:
⚬
refund.do;
-
частичный возврат:
⚬
refund.do.

#### 2

```
После получения успешного ответа платёжного шлюза продавец делает запрос статуса
заказа:
```
-
getOrderStatusExtended.do.

```
Для получения информации о состоянии заказа вместо отправки запроса
getOrderStatusExtended вы можете получать уведомления обратного вызова. Эти
уведомления будут отправляться вам автоматически после изменения статуса
заказа.
```
**Оплата по связкам**

**Оплата по связке (платёжная форма размещена на сервере платёжного шлюза)**

```
Одностадийная оплата Двухстадийная оплата
```
#### 1

```
Плательщик выбирает товар или услугу на ресурсе продавца и выбирает способ оплаты
банковской картой.
```

```
Одностадийная оплата Двухстадийная оплата
```
#### 2

```
Продавец отправляет в платёжный
шлюз запрос на регистрацию заказа:
```
-
register.do.
В том числе в запросе передаются
следующие параметры:
-
clientId - идентификатор клиента
в системе магазина;
-
returnUrl - URL-адрес, на который
будет перенаправлен плательщик в
случае успешного платежа;
-
failUrl - URL-адрес, на который
будет перенаправлен плательщик в
случае неуспешного платежа.
При первичной передаче параметра
clientId происходит регистрация
идентификатора клиента в
платёжном шлюзе и сохранение
данных его карты (кроме CVC-кода).
При последующих передачах этого
параметра клиент перенаправляется
на страницу, где ему предлагается
выбор:
-
использовать ранее сохранённые
данные платёжной карты - в этом
случае клиенту не нужно повторно
заполнять данные платёжной карты
для оплаты;
-
ввести данные новой платёжной
карты - в этом случае к
идентификатору этого клиента
будут дополнительно привязаны
данные новой платёжной карты.

```
Продавец отправляет в платёжный шлюз запрос
на регистрацию заказа с предавторизацией:
```
-
registerPreAuth.do.
В том числе в запросе передаются следующие
параметры:
-
clientId - идентификатор клиента в системе
магазина;
-
amount - сумма списания;
-
orderNumber - номер заказа в системе магазина;
-
returnUrl - URL-адрес, на который будет
перенаправлен плательщик в случае успешного
платежа;
-
failUrl - URL-адрес, на который будет
перенаправлен плательщик в случае неуспешного
платежа.
При первичной передаче параметра clientId
происходит регистрация идентификатора клиента
в платёжном шлюзе и сохранение данных его
карты (кроме CVC-кода). При последующих
передачах этого параметра клиент
перенаправляется на страницу, где ему
предлагается выбор:
-
использовать ранее сохранённые данные
платёжной карты - в этом случае клиенту не
нужно повторно заполнять данные платёжной
карты для оплаты;
-
ввести данные новой платёжной карты - в этом
случае к идентификатору этого клиента будут
дополнительно привязаны данные новой
платёжной карты.

#### 3

```
Платёжный шлюз в ответе в числе прочего возвращает параметры:
```
-
orderId - уникальный идентификатор заказа в платёжной системе;
-
formUrl - URL-адрес формы ввода данных банковской карты (платёжная форма).

#### 4

```
Продавец перенаправляет плательщику URL-адрес, указанный в параметре formUrl
ответа.
```
#### 5

```
В браузере плательщика отображается форма ввода данных банковской карты.
Плательщик заполняет форму и отправляет данные на сервер платёжного шлюза.
```

```
Одностадийная оплата Двухстадийная оплата
```
#### 6

```
Дальнейшие действия зависят от того, поддерживает ли карта покупателя 3-D Secure:
```
-
поддержка 3-D Secure отсутствует - переход к следующему шагу процедуры;
-
есть поддержка 3-D Secure - платёжный шлюз перенаправляет плательщика на форму
аутентификации (чаще всего это проверка с помощью SMS-сообщения), расположенную на
сервере контроля доступа, принадлежащего банку-эмитенту - в случае успешной
аутентификации выполняется следующий шаг сценария.

```
7 Платёжный шлюз списывает деньгисо счёта плательщика. Платёжный шлюз производит холдирование(удержание) средств на счёте плательщика.
```
#### 8

```
После проведения оплаты платёжный шлюз перенаправляет клиента на URL-адрес
возврата (указанный магазином в запросе на регистрацию).
```
```
9 Браузер клиента запрашивает страницу с результатами оплаты у магазина.
```
#### 10

```
Продавец запрашивает у платёжного шлюза статус оплаты заказа, используя уникальный
идентификатор, полученный при регистрации заказа в параметре orderId:
```
-
getOrderStatusExtended.do.

```
11 Платёжный шлюз возвращает статус оплаты и продавец передаёт в браузер клиента
страницу с результатами оплаты.
```
```
12 Не актуально
```
```
Для списания средств со счёта клиента продавец
должен направить в платёжный шлюз запрос
завершения оплаты:
```
-
deposit.do.

```
13 Не актуально
```
```
Платёжный шлюз возвращает результат
обработки запроса. Статус заказа не
возвращается. Для получения статуса заказа
необходимо отправить в шлюз запрос состояния
заказа:
```
-
getOrderStatusExtended.do.

```
Для получения информации о состоянии заказа вместо отправки запроса
getOrderStatusExtended вы можете получать уведомления обратного вызова. Эти
уведомления будут отправляться вам автоматически после изменения статуса
заказа.
```
**Отмена платежа**

Отмена оплаты заказа доступна при наличии соответствующих прав по согласованию со

«Сбербанком».


```
При одностадийных платежах отмена платежа возможна для заказов в
состоянии Завершён/Deposited , но только до закрытия дня, т. е. до 24:00 (по
московскому времени) того дня, когда была произведена оплата.
При двухстадийных платежах отмену платежа можно выполнить для заказа в
состоянии Подтверждён/Approved.
```
В таблице ниже представлена схема взаимодействий продавца и платёжного шлюза при отмене

оплаты.

#### 1

```
Продавец делает запрос на отмену платежа:
```
-
reverse.do.

#### 2

```
После получения успешного ответа платёжного шлюза продавец делает запрос статуса
заказа:
```
-
getOrderStatusExtended.do;

```
Для получения информации о состоянии заказа вместо отправки запроса
getOrderStatusExtended вы можете получать уведомления обратного вызова. Эти
уведомления будут отправляться вам автоматически после изменения статуса
заказа.
```
**Возврат средств плательщику**

Платёжный шлюз позволяет осуществлять полный или частичный возврат средств по оплаченным

заказам.

```
Возврат средств возможен для платежей в состоянии Завершён/Deposited.
```
В таблице ниже представлена схема взаимодействий продавца и платёжного шлюза при возврате

средств покупателю.


#### 1

```
Продавец делает запрос на возврат средств покупателю:
```
-
возврат полной суммы:
⚬
refund.do;
-
частичный возврат:
⚬
refund.do.

#### 2

```
После получения успешного ответа платёжного шлюза продавец делает запрос статуса
заказа:
```
-
getOrderStatusExtended.do.

```
Для получения информации о состоянии заказа вместо отправки запроса
getOrderStatusExtended вы можете получать уведомления обратного вызова. Эти
уведомления будут отправляться вам автоматически после изменения статуса
заказа.
```
**Операции со связками**

```
Запрос деактивации связки
Запрос активации ранее деактивированной связки
Запрос списка связок по идентификатору клиента
Запрос списка связок определённой банковской карты
Запрос изменения срока действия связки
```
Была ли статья полезна?(1) (1)

## Интерфейс WSDL (SOAP)

### Введение

Описание (WSDL) сервиса находится на тестовом сервере, который доступен без ограничений.

Для авторизации обращения магазина к системе платёжного шлюза в любом запросе со стороны

магазина должны быть приведены логин и пароль служебной учётной записи, которые

представитель магазина ввёл при регистрации магазина в системе. Значения имени и пароля

передаются в формате, описанном в рамках спецификации WS-Security, тип авторизации userName

token. Заголовок при такой авторизации выглядит следующим образом.


```
<wsse:Security
xmlns:wsse="http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-
secext-1.0.xsd"
xmlns:wsu="http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-%20wssecurit
y-utility-1.0.xsd">
<wsse:UsernameToken wsu:Id="UsernameToken-87">
<wsse:Username>testuser-api</wsse:Username>
<wsse:Password
Type="http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-username-token-pr
ofile-1.0#PasswordText">test_password</wsse:Password>
</wsse:UsernameToken>
</wsse:Security>
```
В зависимости от выбранной схемы системы оплаты (одностадийная или двухстадийная) синтаксис

запросов различается. На настоящем портале представлены описания обеих схем оплаты.

Если в ответе на запрос возвращается errorCode=0, запрос был обработан платёжным шлюзом без

системных ошибок (при этом параметр errorCode не показывает статус заказа). Для получения

статуса заказа следует использовать запрос getOrderStatusExtended.

### Координаты подключения

```
Для подключения к тестовой службе (WSDL) используйте следующий адрес:
https://3dsec.sberbank.ru/payment/webservices/merchant-ws?wsdl.
```
**Возможные сценарии взаимодействия**

В соответствии с российским законодательством продавцы должны отправлять электронные

версии чеков оператору фискальных данных через интернет. Существует возможность упростить

эту процедуру: вы будете отправлять необходимые данные в запросах, а регистрацию чеков на

контрольно-кассовой технике будет осуществлять «Сбербанк».

```
Сценарии взаимодействия при обычной оплате (регистрация чеков реализуется продавцом
самостоятельно)
Сценарии взаимодействия при регистрации чеков на контрольно-кассовой технике
(регистрация чеков производится «Сбербанком»)
Стандартный API
Apple Pay
```

```
Google Pay
Samsung Pay
Сценарии взаимодействия при оплате по связкам
```
**Обычная оплата**

**Оплата с указанием карточных данных на платёжной странице**

```
Одностадийная оплата Двухстадийная оплата
```
```
1 Плательщик выбирает товар или услугу на ресурсе продавца и выбирает способ оплаты
банковской картой.
```
#### 2

```
Продавец отправляет в платёжный
шлюз запрос на регистрацию заказа:
```
-
registerOrder.
В том числе в запросе передаются
следующие параметры:
-
returnUrl - URL-адрес, на который
будет перенаправлен плательщик в
случае успешного платежа;
-
failUrl - URL-адрес, на который
будет перенаправлен плательщик в
случае неуспешного платежа.

```
Продавец отправляет в платёжный шлюз запрос
на регистрацию заказа с предавторизацией:
```
-
registerOrderPreAuth.
В том числе в запросе передаются следующие
параметры:
-
amount - сумма списания;
-
orderNumber - номер заказа в системе магазина;
-
returnUrl - URL-адрес, на который будет
перенаправлен плательщик в случае успешного
платежа;
-
failUrl - URL-адрес, на который будет
перенаправлен плательщик в случае неуспешного
платежа.

#### 3

```
Платёжный шлюз в ответе в числе прочего возвращает параметры:
```
-
orderId - уникальный идентификатор заказа в платёжной системе;
-
formUrl - URL-адрес формы ввода данных банковской карты (платёжная форма).

#### 4

```
Продавец перенаправляет плательщику URL-адрес, указанный в параметре formUrl
ответа.
```
#### 5

```
В браузере плательщика отображается форма ввода данных банковской карты.
Плательщик заполняет форму и отправляет данные на сервер платёжного шлюза.
```
#### 6

```
Дальнейшие действия зависят от того, поддерживает ли карта покупателя 3-D Secure:
```
-
поддержка 3-D Secure отсутствует - переход к следующему шагу процедуры;
-
есть поддержка 3-D Secure - платёжный шлюз перенаправляет плательщика на форму
аутентификации (чаще всего это проверка с помощью SMS-сообщения), расположенную на
сервере контроля доступа, принадлежащего банку-эмитенту - в случае успешной
аутентификации выполняется следующий шаг сценария.


```
Одностадийная оплата Двухстадийная оплата
```
```
7 Платёжный шлюз списывает деньги
со счёта плательщика.
```
```
Платёжный шлюз производит холдирование
(удержание) средств на счёте плательщика.
```
```
8 После проведения оплаты платёжный шлюз перенаправляет клиента на URL-адрес
возврата (указанный магазином в запросе на регистрацию).
```
```
9 Браузер клиента запрашивает страницу с результатами оплаты у магазина.
```
#### 10

```
Продавец запрашивает у платёжного шлюза статус оплаты заказа, используя уникальный
идентификатор, полученный при регистрации заказа в параметре orderId:
```
-
getOrderStatusExtended.

#### 11

```
Платёжный шлюз возвращает статус оплаты и продавец передаёт в браузер клиента
страницу с результатами оплаты.
```
```
12 Не актуально
```
```
Для списания средств со счёта клиента продавец
должен направить в платёжный шлюз запрос
завершения оплаты:
```
-
depositOrder.

```
13 Не актуально
```
```
Платёжный шлюз возвращает результат
обработки запроса. Статус заказа не
возвращается. Для получения статуса заказа
необходимо отправить в шлюз запрос состояния
заказа:
```
-
getOrderStatusExtended.

```
Для получения информации о состоянии заказа вместо отправки запроса
getOrderStatusExtended вы можете получать уведомления обратного вызова. Эти
уведомления будут отправляться вам автоматически после изменения статуса
заказа.
```
**Отмена платежа**

Отмена оплаты заказа доступна при наличии соответствующих прав по согласованию со

«Сбербанком».

```
При одностадийных платежах отмена платежа возможна для заказов в
состоянии Завершён/Deposited , но только до закрытия дня, т. е. до 24:00 (по
московскому времени) того дня, когда была произведена оплата.
При двухстадийных платежах отмену платежа можно выполнить для заказа в
```

```
состоянии Подтверждён/Approved.
```
В таблице ниже представлена схема взаимодействий продавца и платёжного шлюза при отмене

оплаты.

#### 1

```
Продавец делает запрос на отмену платежа:
```
-
reverseOrder.

#### 2

```
После получения успешного ответа платёжного шлюза продавец делает запрос статуса
заказа:
```
-
getOrderStatusExtended.

```
Для получения информации о состоянии заказа вместо отправки запроса
getOrderStatusExtended вы можете получать уведомления обратного вызова. Эти
уведомления будут отправляться вам автоматически после изменения статуса
заказа.
```
**Возврат средств плательщику**

Платёжный шлюз позволяет осуществлять полный или частичный возврат средств по оплаченным

заказам.

```
Возврат средств возможен для платежей в состоянии Завершён/Deposited.
```
В таблице ниже представлена схема взаимодействий продавца и платёжного шлюза при возврате

средств покупателю.

#### 1

```
Продавец делает запрос на возврат средств покупателю:
```
-
refundOrder.

#### 2

```
После получения успешного ответа платёжного шлюза продавец делает запрос статуса
заказа:
```
-
getOrderStatusExtended.


```
Для получения информации о состоянии заказа вместо отправки запроса
getOrderStatusExtended вы можете получать уведомления обратного вызова. Эти
уведомления будут отправляться вам автоматически после изменения статуса
заказа.
```
**Оплата с регистрацией чеков на контрольно-кассовой технике**

**Стандартный API**

**Оплата с передачей корзины и данных для регистрации чека**

```
Одностадийная оплата Двухстадийная оплата
```
```
1 Плательщик выбирает товар или услугу на ресурсе продавца и выбирает способ оплатыбанковской картой.
```
#### 2

```
Продавец отправляет в платёжный
шлюз запрос на регистрацию заказа:
```
-
registerOrder.
В том числе в запросе передаются
следующие параметры:
-
returnUrl - URL-адрес, на который
будет перенаправлен плательщик в
случае успешного платежа;
-
failUrl - URL-адрес, на который
будет перенаправлен плательщик в
случае неуспешного платежа.
-
orderBundle - блок, содержащий
корзину товаров и данные для
регистрации чека;
-
taxSystem - идентификатор системы
налогообложения.

```
Продавец отправляет в платёжный шлюз запрос
на регистрацию заказа с предавторизацией:
```
-
registerOrderPreAuth.
В том числе в запросе передаются следующие
параметры:
-
amount - сумма списания;
-
orderNumber - номер заказа в системе магазина;
-
returnUrl - URL-адрес, на который будет
перенаправлен плательщик в случае успешного
платежа;
-
failUrl - URL-адрес, на который будет
перенаправлен плательщик в случае неуспешного
платежа.
-
orderBundle - блок, содержащий корзину
товаров и данные для регистрации чека;
-
taxSystem - идентификатор системы
налогообложения.

#### 3

```
Платёжный шлюз в ответе в числе прочего возвращает параметры:
```
-
orderId - уникальный идентификатор заказа в платёжной системе;
-
formUrl - URL-адрес формы ввода данных банковской карты (платёжная форма).

```
4 Продавец перенаправляет плательщикуответа. URL-адрес, указанный в параметре formUrl
```

```
Одностадийная оплата Двухстадийная оплата
```
**5** В браузере плательщика отображается форма ввода данных банковской карты.
Плательщик заполняет форму и отправляет данные на сервер платёжного шлюза.

#### 6

```
Дальнейшие действия зависят от того, поддерживает ли карта покупателя 3-D Secure:
```
-
поддержка 3-D Secure отсутствует - переход к следующему шагу процедуры;
-
есть поддержка 3-D Secure - платёжный шлюз перенаправляет плательщика на форму
аутентификации (чаще всего это проверка с помощью SMS-сообщения), расположенную на
сервере контроля доступа, принадлежащего банку-эмитенту - в случае успешной
аутентификации выполняется следующий шаг сценария.

#### 7

```
Платёжный шлюз списывает деньги
со счёта плательщика.
```
```
Платёжный шлюз производит холдирование
(удержание) средств на счёте плательщика.
```
#### 8

```
После проведения оплаты платёжный шлюз перенаправляет клиента на URL-адрес
возврата.
```
**9** Браузер клиента запрашивает страницу с результатами оплаты у магазина.

#### 10

```
Продавец запрашивает у платёжного шлюза статус оплаты заказа, используя уникальный
идентификатор, полученный при регистрации заказа в параметре orderId:
```
-
getOrderStatusExtended;

**11** Платёжный шлюз возвращает статус оплаты и продавец передаёт в браузер клиентастраницу с результатами оплаты.

**12 Не актуально**

```
Для списания средств со счёта клиента продавец
должен направить в платёжный шлюз запрос
завершения оплаты:
```
-
завершение с оплатой полной суммой:
⚬
depositOrder.
-
завершение с оплатой части суммы:
⚬
depositOrder.

**13 Не актуально**

```
Платёжный шлюз возвращает результат
обработки запроса. Статус заказа не
возвращается. Для получения статуса заказа
необходимо отправить в шлюз запрос состояния
заказа:
```
-
getOrderStatusExtended.

```
Для получения информации о состоянии заказа вместо отправки запроса
getOrderStatusExtended вы можете получать уведомления обратного вызова. Эти
уведомления будут отправляться вам автоматически после изменения статуса
```

```
заказа.
```
```
Чтобы получить сведения о кассовом чеке (например, чтобы передать эти данные
покупателю) используйте запрос getReceiptStatus.do. В настоящее время этот запрос
можно выполнить только через интерфейс REST.
```
**Отмена платежа**

Отмена оплаты заказа доступна при наличии соответствующих прав по согласованию со

«Сбербанком».

```
При одностадийных платежах отмена платежа возможна для заказов в
состоянии Завершён/Deposited , но только до закрытия дня, т. е. до 24:00 (по
московскому времени) того дня, когда была произведена оплата.
При двухстадийных платежах отмену платежа можно выполнить для заказа в
состоянии Подтверждён/Approved.
```
В таблице ниже представлена схема взаимодействий продавца и платёжного шлюза при отмене

оплаты.

#### 1

```
Продавец делает запрос на отмену платежа:
```
-
reverseOrder.

#### 2

```
После получения успешного ответа платёжного шлюза продавец делает запрос статуса
заказа:
```
-
getOrderStatusExtended.

```
Для получения информации о состоянии заказа вместо отправки запроса
getOrderStatusExtended вы можете получать уведомления обратного вызова. Эти
уведомления будут отправляться вам автоматически после изменения статуса
заказа.
```
**Возврат средств плательщику**


Платёжный шлюз позволяет осуществлять полный или частичный возврат средств по оплаченным

заказам.

```
Возврат средств возможен для платежей в состоянии Завершён/Deposited.
```
В таблице ниже представлена схема взаимодействий продавца и платёжного шлюза при возврате

средств покупателю.

#### 1

```
Продавец делает запрос на возврат средств покупателю:
```
-
возврат полной суммы:
⚬
refundOrder;
-
частичный возврат:
⚬
refundOrder.

#### 2

```
После получения успешного ответа платёжного шлюза продавец делает запрос статуса
заказа:
```
-
getOrderStatusExtended.

```
Для получения информации о состоянии заказа вместо отправки запроса
getOrderStatusExtended вы можете получать уведомления обратного вызова. Эти
уведомления будут отправляться вам автоматически после изменения статуса
заказа.
```
**Apple Pay**

**Оплата через Apple Pay (передача корзины)**

При оплате с использованием Apple Pay взаимодействие происходит по следующей схеме.

```
Одностадийный платёж Двухстадийный платёж
```
```
1 Пользователь в мобильном приложении выбирает вариант оплаты с помощью Apple Pay.
```
```
2 Сведения о платеже направляются на обработку в систему Apple Pay.
```

```
Одностадийный платёж Двухстадийный платёж
```
#### 3

```
Для обработки данных о платеже в системе Apple Pay создаётся объект PKPaymentToken
Object, который содержит свойство paymentData (здесь и далее см. документацию Apple
Pay).
```
```
4 Apply Pay направляет продавцу (мобильному приложению) ответ.
```
```
5 Продавец извлекает из полученного объекта paymentData и кодирует его содержимое в Base64.PKPaymentToken Object свойство
```
#### 6

```
Продавец создаёт запрос на оплату,
содержащий в том числе свойство
paymentData, полученное из ответа
системы Apple Pay и закодированное
в Base64, и отправляет его на
обработку в платёжный шлюз. Для
оплаты через Apple Pay используется
следующий запрос:
```
-
applePay (интерфейс WSDL).
При этом параметр preAuth либо не
передаётся, либо имеет значение
false (ложь).

```
Продавец создаёт запрос на оплату, содержащий
в том числе свойство paymentData, полученное из
ответа системы Apple Pay и закодированное в
Base64, и отправляет его на обработку в
платёжный шлюз. Для оплаты через Apple Pay
используется следующий запрос:
```
-
applePay (интерфейс WSDL).
При этом в запросе передаётся параметр
preAuth, который имеет значение true (истина).

#### 7

```
Платёжный шлюз обрабатывает запрос и возвращает ответ с результатом:
```
-
интерфейс WSDL.

```
8 Мобильное приложение отображает пользователю результат оплаты.
```
#### 9

```
Продавец запрашивает у платёжного шлюза статус оплаты заказа, используя уникальный
идентификатор, полученный при регистрации заказа в параметре orderId:
```
-
getOrderStatusExtended (интерфейс WSDL).

```
10 Не актуально
```
```
Для списания средств со счёта клиента продавец
должен направить в платёжный шлюз запрос
завершения оплаты:
```
-
depositOrder (интерфейс WSDL).

```
11 Не актуально
```
```
Платёжный шлюз возвращает результат
обработки запроса. Статус заказа не
возвращается. Для получения статуса заказа
необходимо отправить в шлюз запрос состояния
заказа:
```
-
getOrderStatusExtended (интерфейс WSDL).

**Google Pay**


**Оплата через Google Pay (передача корзины)**

```
Сведения для разработчиков представлены на сайте Google.
Приложение должно быть оформлено в соответствии с руководством по
использованию бренда.
```
При отправке запроса в Google Pay используйте следующие параметры:

```
gateway: sberbank;
gatewayMerchantId: <наименование вашей организации в системе платёжного шлюза>.
```
При оплате с использованием Google Pay через мобильное приложение взаимодействие происходит

по следующей схеме.

```
Одностадийный платёж Двухстадийный платёж
```
```
1 Пользователь выбирает способ оплаты Google Pay.
```
```
2 Приложение запрашивает Google Pay маскированные данные платёжной карты.
```
```
3 Google Pay возвращает в приложение маскированные данные платёжной карты.
```
#### 4

```
Приложение отображает клиенту маскированные данные карты, добавленной в Google
Pay.
```
```
5 Пользователь подтверждает оплату.
```
```
6 Приложение запрашивает Google Pay зашифрованные данные платёжной карты.
```
```
7 Google шифрует данные, используя открытый ключ - соответствующий ему закрытый ключ
расположен в платёжном шлюзе.
```
```
8 Google Pay возвращает в приложение зашифрованные данные о платеже.
```
#### 9

```
Приложение отправляет в
платёжный шлюз запрос на оплату,
указывая полученный от Google Pay
токен:
```
-
интерфейс WSDL (googlePay).
При этом параметр preAuth либо не
передаётся, либо имеет значение
false (ложь).

```
Приложение отправляет в платёжный шлюз запрос
на оплату, указывая полученный от Google Pay
токен:
```
-
интерфейс WSDL (goooglePay).
При этом в запросе передаётся параметр preAuth,
который имеет значение true (истина).


```
Одностадийный платёж Двухстадийный платёж
```
```
10 Платёжный шлюз расшифровывает полученный токен и производит оплату.
```
```
11 Платёжный шлюз возвращает результат оплаты в приложение.
```
```
12 Приложение отображает результат покупки плательщику.
```
#### 13

```
Продавец запрашивает у платёжного шлюза статус оплаты заказа, используя уникальный
идентификатор, полученный при регистрации заказа в параметре orderId:
```
-
интерфейс WSDL (getOrderStatusExtended).

```
14 Не актуально
```
```
Для списания средств со счёта клиента продавец
должен направить в платёжный шлюз запрос
завершения оплаты:
```
-
интерфейс WSDL (depositOrder).

```
15 Не актуально
```
```
Платёжный шлюз возвращает результат обработки
запроса. Статус заказа не возвращается. Для
получения статуса заказа необходимо отправить в
шлюз запрос состояния заказа:
```
-
интерфейс WSDL (getOrderStatusExtended).

**Samsung Pay**

**Оплата через Samsung Pay из мобильного приложения**

При оплате с использованием Samsung Pay взаимодействие происходит по следующей схеме.

```
Одностадийный платёж Двухстадийный платёж
```
```
1 Пользователь выбирает способ оплаты Samsung Pay.
```
```
2 Приложение отправляет сведения о платеже в Samsung.
```
#### 3

```
Samsung отправляет в приложение ответ содержащий, среди прочего, парамер 3ds.data с
зашифрованными данными о платеже.
```

```
Одностадийный платёж Двухстадийный платёж
```
#### 4

```
Продавец отправляет в платёжный
шлюз запрос на оплату:
```
-
интерфейс WSDL (samsungPay).
При этом:
-
параметр paymentToken включает
содержимое 3ds.data, полученное
от Samsung;
-
параметр preAuth либо не
передаётся, либо имеет значение
false (ложь).

```
Продавец отправляет в платёжный шлюз запрос на
оплату:
```
-
интерфейс WSDL (samsungPay).
При этом:
-
параметр paymentToken включает содержимое
3ds.data, полученное от Samsung;
-
в запросе передаётся параметр preAuth, который
имеет значение true (истина).

```
5 Платёжный шлюз расшифровывает полученный токен и производит оплату.
```
```
6 Платёжный шлюз возвращает в приложение результат оплаты, который отображается наэкране мобильного устройства.
```
#### 7

```
Продавец запрашивает у платёжного шлюза статус оплаты заказа, используя уникальный
идентификатор, полученный при регистрации заказа в параметре orderId:
```
-
интерфейс WSDL (getOrderStatusExtended).

```
8 Не актуально
```
```
Для списания средств со счёта клиента продавец
должен направить в платёжный шлюз запрос
завершения оплаты:
```
-
интерфейс WSDL (depositOrder).

```
9 Не актуально
```
```
Платёжный шлюз возвращает результат обработки
запроса. Статус заказа не возвращается. Для
получения статуса заказа необходимо отправить в
шлюз запрос состояния заказа:
```
-
интерфейс WS (getOrderStatusExtended).

**Оплата по связкам**

**Оплата по связке (платёжная форма размещена на сервере платёжного шлюза)**

```
Одностадийная оплата Двухстадийная оплата
```
```
1 Плательщик выбирает товар или услугу на ресурсе продавца и выбирает способ оплаты
банковской картой.
```

```
Одностадийная оплата Двухстадийная оплата
```
#### 2

```
Продавец отправляет в платёжный
шлюз запрос на регистрацию заказа:
```
-
registerOrder.
В том числе в запросе передаются
следующие параметры:
-
clientId - идентификатор клиента в
системе магазина;
-
returnUrl - URL-адрес, на который
будет перенаправлен плательщик в
случае успешного платежа;
-
failUrl - URL-адрес, на который
будет перенаправлен плательщик в
случае неуспешного платежа.
При первичной передаче параметра
clientId происходит регистрация
идентификатора клиента в
платёжном шлюзе и сохранение
данных его карты (кроме CVC-кода).
При последующих передачах этого
параметра клиент перенаправляется
на страницу, где ему предлагается
выбор:
-
использовать ранее сохранённые
данные платёжной карты - в этом
случае клиенту не нужно повторно
заполнять данные платёжной карты
для оплаты;
-
ввести данные новой платёжной
карты - в этом случае к
идентификатору этого клиента будут
дополнительно привязаны данные
новой платёжной карты.

```
Продавец отправляет в платёжный шлюз запрос
на регистрацию заказа с предавторизацией:
```
-
registerOrderPreAuth.
В том числе в запросе передаются следующие
параметры:
-
clientId - идентификатор клиента в системе
магазина;
-
amount - сумма списания;
-
orderNumber - номер заказа в системе магазина;
-
returnUrl - URL-адрес, на который будет
перенаправлен плательщик в случае успешного
платежа;
-
failUrl - URL-адрес, на который будет
перенаправлен плательщик в случае
неуспешного платежа.
При первичной передаче параметра clientId
происходит регистрация идентификатора
клиента в платёжном шлюзе и сохранение
данных его карты (кроме CVC-кода). При
последующих передачах этого параметра клиент
перенаправляется на страницу, где ему
предлагается выбор:
-
использовать ранее сохранённые данные
платёжной карты - в этом случае клиенту не
нужно повторно заполнять данные платёжной
карты для оплаты;
-
ввести данные новой платёжной карты - в этом
случае к идентификатору этого клиента будут
дополнительно привязаны данные новой
платёжной карты.

#### 3

```
Платёжный шлюз в ответе в числе прочего возвращает параметры:
```
-
orderId - уникальный идентификатор заказа в платёжной системе;
-
formUrl - URL-адрес формы ввода данных банковской карты (платёжная форма).

#### 4

```
Продавец перенаправляет плательщику URL-адрес, указанный в параметре formUrl
ответа.
```
#### 5

```
В браузере плательщика отображается форма ввода данных банковской карты.
Плательщик заполняет форму и отправляет данные на сервер платёжного шлюза.
```

```
Одностадийная оплата Двухстадийная оплата
```
#### 6

```
Дальнейшие действия зависят от того, поддерживает ли карта покупателя 3-D Secure:
```
-
поддержка 3-D Secure отсутствует - переход к следующему шагу процедуры;
-
есть поддержка 3-D Secure - платёжный шлюз перенаправляет плательщика на форму
аутентификации (чаще всего это проверка с помощью SMS-сообщения), расположенную на
сервере контроля доступа, принадлежащего банку-эмитенту - в случае успешной
аутентификации выполняется следующий шаг сценария.

```
7 Платёжный шлюз списывает деньги сосчёта плательщика. Платёжный шлюз производит холдирование(удержание) средств на счёте плательщика.
```
#### 8

```
После проведения оплаты платёжный шлюз перенаправляет клиента на URL-адрес
возврата (указанный магазином в запросе на регистрацию).
```
```
9 Браузер клиента запрашивает страницу с результатами оплаты у магазина.
```
#### 10

```
Продавец запрашивает у платёжного шлюза статус оплаты заказа, используя уникальный
идентификатор, полученный при регистрации заказа в параметре orderId:
```
-
getOrderStatusExtended.

```
11 Платёжный шлюз возвращает статус оплаты и продавец передаёт в браузер клиента
страницу с результатами оплаты.
```
```
12 Не актуально
```
```
Для списания средств со счёта клиента продавец
должен направить в платёжный шлюз запрос
завершения оплаты:
```
-
depositOrder.

```
13 Не актуально
```
```
Платёжный шлюз возвращает результат
обработки запроса. Статус заказа не
возвращается. Для получения статуса заказа
необходимо отправить в шлюз запрос состояния
заказа:
```
-
getOrderStatusExtended.

```
Для получения информации о состоянии заказа вместо отправки запроса
getOrderStatusExtended вы можете получать уведомления обратного вызова. Эти
уведомления будут отправляться вам автоматически после изменения статуса
заказа.
```
**Отмена платежа**

Отмена оплаты заказа доступна при наличии соответствующих прав по согласованию со

«Сбербанком».


```
При одностадийных платежах отмена платежа возможна для заказов в
состоянии Завершён/Deposited , но только до закрытия дня, т. е. до 24:00 (по
московскому времени) того дня, когда была произведена оплата.
При двухстадийных платежах отмену платежа можно выполнить для заказа в
состоянии Подтверждён/Approved.
```
В таблице ниже представлена схема взаимодействий продавца и платёжного шлюза при отмене

оплаты.

#### 1

```
Продавец делает запрос на отмену платежа:
```
-
reverseOrder.

#### 2

```
После получения успешного ответа платёжного шлюза продавец делает запрос статуса
заказа:
```
-
getOrderStatusExtended.

```
Для получения информации о состоянии заказа вместо отправки запроса
getOrderStatusExtended вы можете получать уведомления обратного вызова. Эти
уведомления будут отправляться вам автоматически после изменения статуса
заказа.
```
**Возврат средств плательщику**

Платёжный шлюз позволяет осуществлять полный или частичный возврат средств по оплаченным

заказам.

```
Возврат средств возможен для платежей в состоянии Завершён/Deposited.
```
В таблице ниже представлена схема взаимодействий продавца и платёжного шлюза при возврате

средств покупателю.


#### 1

```
Продавец делает запрос на возврат средств покупателю:
```
-
возврат полной суммы:
⚬
refundOrder;
-
частичный возврат:
⚬
refundOrder.

#### 2

```
После получения успешного ответа платёжного шлюза продавец делает запрос статуса
заказа:
```
-
getOrderStatusExtended.

```
Для получения информации о состоянии заказа вместо отправки запроса
getOrderStatusExtended вы можете получать уведомления обратного вызова. Эти
уведомления будут отправляться вам автоматически после изменения статуса
заказа.
```
**Операции со связками**

```
Запрос деактивации связки.
Запрос активации ранее деактивированной связки.
Запрос списка связок по идентификатору клиента.
Запрос списка связок определённой банковской карты.
Запрос изменения срока действия связки.
```
Была ли статья полезна?(1) Была ли статья полезна?(2) (1)(0)


